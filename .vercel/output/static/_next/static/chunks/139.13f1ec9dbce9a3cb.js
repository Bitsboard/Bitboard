"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[139],{6463:function(e,t,a){var r=a(1169);a.o(r,"useParams")&&a.d(t,{useParams:function(){return r.useParams}}),a.o(r,"useRouter")&&a.d(t,{useRouter:function(){return r.useRouter}}),a.o(r,"useSearchParams")&&a.d(t,{useSearchParams:function(){return r.useSearchParams}})},3139:function(e,t,a){a.r(t),a.d(t,{default:function(){return m}});var r=a(7437),l=a(2265),n=a(6463),s=a(8969),i=a(9354),c=a(6248),o=a(6062),u=a(8070);let d=[{country:"Canada",region:"Ontario",city:"Toronto",lat:43.6532,lng:-79.3832},{country:"Canada",region:"Ontario",city:"Ottawa",lat:45.4215,lng:-75.6972},{country:"Canada",region:"British Columbia",city:"Vancouver",lat:49.2827,lng:-123.1207}];function m(){let e=(0,n.useSearchParams)(),t=(0,n.useRouter)(),{theme:a,unit:m,layout:g}=(0,u.rV)(),x="dark"===a,h=(e.get("layout")||"").trim(),[p,b]=(0,l.useState)([]),[f,v]=(0,l.useState)(0),[y,w]=(0,l.useState)(!0),[S,N]=(0,l.useState)(!1),[j,k]=(0,l.useState)(!1),[C,E]=(0,l.useState)(null),[_,L]=(0,l.useState)(null),P=(0,l.useRef)(!1),R=(0,l.useRef)(null),B=(0,o.J)(),I=(e.get("q")||"").trim(),U=(e.get("category")||"").trim(),M=(e.get("adType")||"all").trim(),O=e.get("minPrice"),T=e.get("maxPrice"),D=(e.get("sortBy")||"date").trim(),F=(e.get("sortOrder")||"desc").trim(),A=e.get("lat"),K=e.get("lng"),[q,J]=(0,l.useState)(I),[G,H]=(0,l.useState)(null!=O?O:""),[V,z]=(0,l.useState)(null!=T?T:""),[$,Q]=(0,l.useState)(U),[W,X]=(0,l.useState)(M),[Y,Z]=(0,l.useState)("".concat(D,":").concat(F)),[ee,et]=(0,l.useState)(""),[ea,er]=(0,l.useState)(""),[el,en]=(0,l.useState)(""),[es,ei]=(0,l.useState)(null!=A?A:""),[ec,eo]=(0,l.useState)(null!=K?K:""),[eu,ed]=(0,l.useState)(()=>{try{let e=localStorage.getItem("userRadiusKm");if(e)return Number(e)}catch(e){}return 25}),[em,eg]=(0,l.useState)(!1);(0,l.useEffect)(()=>{J(I)},[I]),(0,l.useEffect)(()=>{try{let e=localStorage.getItem("theme");if("dark"===e||"light"===e)document.documentElement.classList.toggle("dark","dark"===e);else{let e=document.documentElement.classList.contains("dark");document.documentElement.classList.toggle("dark",e)}}catch(e){}},[]),(0,l.useEffect)(()=>{let e=e=>{e.detail},t=e=>{e.detail},a=e=>{let t=e.detail;try{t&&document.documentElement.classList.toggle("dark","dark"===t)}catch(e){}};return window.addEventListener("bb:unit",e),window.addEventListener("bb:layout",t),window.addEventListener("bb:theme",a),()=>{window.removeEventListener("bb:unit",e),window.removeEventListener("bb:layout",t),window.removeEventListener("bb:theme",a)}},[]),(0,l.useEffect)(()=>{try{let e=window.location.pathname.split("/").filter(Boolean)[0];e&&["en","fr","es","de"].includes(e)&&(document.documentElement.lang=e)}catch(e){}},[]),(0,l.useEffect)(()=>{try{let e=Number(localStorage.getItem("userRadiusKm")||"");Number.isFinite(e)&&ed(e)}catch(e){}},[B]),(0,l.useEffect)(()=>{Q(U)},[U]),(0,l.useEffect)(()=>{X(M)},[M]),(0,l.useEffect)(()=>{H(null!=O?O:"")},[O]),(0,l.useEffect)(()=>{z(null!=T?T:"")},[T]),(0,l.useEffect)(()=>{Z("".concat(D,":").concat(F))},[D,F]),(0,l.useEffect)(()=>{ei(null!=A?A:""),eo(null!=K?K:"")},[A,K]),(0,l.useEffect)(()=>{if(!A||!K)try{let e=localStorage.getItem("userLocation");if(e){let t=JSON.parse(e);(null==t?void 0:t.lat)&&(null==t?void 0:t.lng)&&(ei(String(t.lat)),eo(String(t.lng)))}}catch(e){}},[]),(0,l.useEffect)(()=>{try{localStorage.getItem("usingMyLocation")}catch(e){}},[B]),(0,l.useEffect)(()=>{},[h]),(0,l.useEffect)(()=>{fetch("/api/rate").then(e=>e.json()).then(e=>{L(e.cad)}).catch(()=>{})},[]),(0,l.useEffect)(()=>{let e=new URLSearchParams(window.location.search);g&&e.set("layout",g);let a="/".concat(B,"/search?").concat(e.toString());a!==window.location.pathname+window.location.search&&t.replace(a)},[g]);let ex=(0,l.useCallback)(e=>e.map(e=>{var t,a;return{id:String(e.id),title:e.title,desc:(null!==(t=e.description)&&void 0!==t?t:"")+"\n\n"+"Lorem ipsum dolor sit amet, consectetur adipiscing elit. ".repeat(40),priceSats:Number(e.priceSat)||0,category:e.category||"Electronics",location:(e.location||"").replace(/\s*[•|\-].*$/,"").replace(/\(.*?\)/g,"").trim().replace(/\s{2,}/g," ").replace(/,\s*,/g,", ").replace(/\s+,\s+/g,", ")||"Toronto, ON",lat:Number.isFinite(e.lat)?e.lat:43.6532,lng:Number.isFinite(e.lng)?e.lng:-79.3832,type:"want"===e.adType?"want":"sell",images:Array.isArray(e.imageUrl)&&e.imageUrl.length>0?e.imageUrl:"string"==typeof e.imageUrl&&e.imageUrl.includes(",")?e.imageUrl.split(",").map(e=>e.trim()).filter(Boolean):[..."string"==typeof e.imageUrl&&e.imageUrl?[e.imageUrl]:[],"https://images.unsplash.com/photo-1555617117-08d3a8fef16c?w=1200&q=80&auto=format&fit=crop","https://images.unsplash.com/photo-1518779578993-ec3579fee39f?w=1200&q=80&auto=format&fit=crop","https://images.unsplash.com/photo-1517336714731-489689fd1ca8?w=1200&q=80&auto=format&fit=crop"].slice(0,5),boostedUntil:null!==(a=e.boostedUntil)&&void 0!==a?a:null,seller:(()=>{let t=(e.postedBy||"demo_seller").replace(/^@/,""),a=Number(e.id)%100,r=5+a%80,l=r>=50;return{name:t,score:r,deals:a%40,rating:4+a%10/10,verifications:{email:!0,phone:l,lnurl:l},onTimeRelease:l?.97:.9}})(),createdAt:1e3*Number(e.createdAt)}}),[]),eh=e=>{if(!e)return null;let t=Number(e);return Number.isFinite(t)?"BTC"===m?String(Math.round(1e8*t)):String(Math.round(t)):null},ep=()=>{let e=d.find(e=>e.country===ee&&e.region===ea&&e.city===el);return e?{lat:String(e.lat),lng:String(e.lng)}:{lat:es,lng:ec}},eb=(0,l.useCallback)(e=>{let t=new URLSearchParams;q&&t.set("q",q),$&&t.set("category",$),W&&"all"!==W&&t.set("adType",W);let a=eh(G),r=eh(V);a&&t.set("minPrice",a),r&&t.set("maxPrice",r);let[l,n]=((null!=e?e:Y)||"date:desc").split(":");t.set("sortBy","distance"===l?"distance":l),t.set("sortOrder","distance"===l?"asc":n),t.set("layout",g);let s=(()=>{try{let e=localStorage.getItem("userRadiusKm");if(e)return Number(e)}catch(e){}return null})(),i=Number.isFinite(eu)?eu:null!=s?s:null,{lat:c,lng:o}=ep();return c&&o&&(t.set("lat",c),t.set("lng",o)),null!=i&&t.set("radiusKm",String(i)),t},[q,$,W,G,V,Y,m,ee,ea,el,es,ec,g,eu]),ef=(0,l.useCallback)(e=>{let t=eb();return t.set("limit",String(24)),t.set("offset",String(e)),"/api/listings?".concat(t.toString())},[eb]);(0,l.useEffect)(()=>{(async()=>{try{var e,t;P.current=!0,k(!1);let a=await fetch(ef(0)),r=await a.json(),l=null!==(e=r.listings)&&void 0!==e?e:[],n=ex(l);b(n);let s=Number(null!==(t=r.total)&&void 0!==t?t:0);v(s),w(n.length<s)}finally{P.current=!1,k(!0)}})()},[ef,ex]);let ev=(0,l.useCallback)(async()=>{if(!P.current&&y){P.current=!0,N(!0);try{var e,t;let a=await fetch(ef(p.length)),r=await a.json(),l=null!==(e=r.listings)&&void 0!==e?e:[],n=ex(l);b(e=>[...e,...n]);let s=Number(null!==(t=r.total)&&void 0!==t?t:f);v(s),w(p.length+n.length<s)}finally{P.current=!1,N(!1)}}},[ef,y,p.length,ex,f]);(0,l.useEffect)(()=>{let e=R.current;if(!e)return;let t=new IntersectionObserver(e=>{for(let t of e)if(t.isIntersecting){ev();break}},{rootMargin:"1000px 0px"});return t.observe(e),()=>t.disconnect()},[ev]);let ey=x?"bg-gradient-to-br from-neutral-950 via-neutral-900 to-neutral-950":"bg-gradient-to-br from-neutral-50 via-white to-neutral-100",[ew,eS]=(0,l.useState)(!1);(0,l.useEffect)(()=>{fetch("/api/auth/session",{cache:"no-store"}).then(e=>e.json()).then(e=>eS(!!(null==e?void 0:e.session))).catch(()=>eS(!1))},[]);let eN=x?"border border-white/30 bg-neutral-800/50 text-neutral-100 placeholder-neutral-400 backdrop-blur-sm":"border border-neutral-700/30 bg-white/80 text-neutral-900 placeholder-neutral-500 backdrop-blur-sm",ej=()=>{let e=eb();t.push("/".concat(B,"/search?").concat(e.toString()))},ek=j&&0===p.length;(0,l.useMemo)(()=>Array.from(new Set(d.map(e=>e.country))),[]);let eC=(0,l.useMemo)(()=>d.filter(e=>e.country===ee),[ee]);return(0,l.useMemo)(()=>Array.from(new Set(eC.map(e=>e.region))),[eC]),(0,l.useMemo)(()=>eC.filter(e=>e.region===ea).map(e=>e.city),[eC,ea]),(0,r.jsxs)("div",{className:(0,i.cn)("min-h-screen",ey,x?"dark":""),children:[(0,r.jsxs)("div",{className:"mx-auto max-w-7xl px-4 py-8",children:[(0,r.jsxs)("div",{className:"mb-6 grid grid-cols-1 gap-4 sm:grid-cols-12",children:[(0,r.jsxs)("div",{className:"sm:col-span-9 relative",children:[(0,r.jsx)("input",{value:q,onChange:e=>J(e.target.value),onKeyDown:e=>{"Enter"===e.key&&ej()},placeholder:(0,c.t)("search",B)+" bikes, ASICs, consoles…",className:(0,i.cn)("w-full rounded-3xl px-6 pr-32 py-5 text-lg focus:outline-none transition-all duration-300",eN)}),(0,r.jsx)("button",{onClick:ej,className:"absolute right-3 top-1/2 -translate-y-1/2 rounded-2xl bg-gradient-to-r from-orange-500 to-red-500 px-5 py-2 text-sm font-semibold text-white shadow",children:(0,c.t)("search",B)})]}),(0,r.jsx)("div",{className:"sm:col-span-3 flex items-center gap-2",children:(0,r.jsxs)("select",{value:Y,onChange:e=>{let a=e.target.value;Z(a);let r=eb(a);t.push("/".concat(B,"/search?").concat(r.toString()))},className:(0,i.cn)("w-full max-w-xs rounded-3xl px-6 pr-10 py-5 text-lg appearance-none bg-no-repeat bg-right",eN),style:{backgroundImage:"url(\"data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e\")",backgroundPosition:"right 0.75rem center",backgroundSize:"1.25em 1.25em"},children:[(0,r.jsx)("option",{value:"date:desc",children:(0,c.t)("newest",B)}),(0,r.jsx)("option",{value:"date:asc",children:(0,c.t)("oldest",B)}),(0,r.jsx)("option",{value:"price:desc",children:(0,c.t)("highest_price",B)}),(0,r.jsx)("option",{value:"price:asc",children:(0,c.t)("lowest_price",B)})]})})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-12",children:[(0,r.jsxs)("aside",{className:"lg:col-span-3 space-y-4",children:[(0,r.jsxs)("div",{className:(0,i.cn)("rounded-2xl p-4",x?"border border-neutral-800 bg-neutral-950":"border border-neutral-300 bg-white"),children:[(0,r.jsxs)("div",{className:"flex items-start justify-between",children:[(0,r.jsx)("div",{className:(0,i.cn)("font-semibold",x?"text-neutral-200":"text-neutral-900"),children:(0,c.t)("location",B)}),(0,r.jsx)("div",{children:(0,r.jsx)("button",{onClick:()=>eg(!0),className:"rounded-xl px-3 py-1 text-xs text-white bg-gradient-to-r from-orange-500 to-red-500",children:(0,c.t)("change",B)})})]}),0===eu?(0,r.jsx)("div",{className:(0,i.cn)("mt-3",x?"text-neutral-200":"text-neutral-800"),children:(0,c.t)("all_listings_globally",B)}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:(0,i.cn)("mt-3 text-xs",x?"text-neutral-400":"text-neutral-600"),children:(0,c.t)("within_km_of",B).replace("{n}",String(eu))}),(0,r.jsx)("div",{className:(0,i.cn)("mt-1",x?"text-neutral-200":"text-neutral-800"),title:(()=>{try{let e=localStorage.getItem("userLocation");if(e){let t=JSON.parse(e);if(null==t?void 0:t.name)return t.name}}catch(e){}})(),children:(()=>{try{let e=localStorage.getItem("userLocation");if(e){let t=JSON.parse(e);if(null==t?void 0:t.name)return"".concat(t.name)}}catch(e){}return(0,c.t)("set_location",B)})()})]})]}),(0,r.jsxs)("div",{className:(0,i.cn)("rounded-2xl p-4",x?"border border-neutral-800 bg-neutral-950":"border border-neutral-300 bg-white"),children:[(0,r.jsx)("div",{className:(0,i.cn)("font-semibold mb-3",x?"text-neutral-200":"text-neutral-900"),children:(0,c.t)("category",B)}),(0,r.jsx)("div",{className:"flex flex-wrap gap-2",children:[{key:"cat_all",value:""},{key:"cat_electronics",value:"Electronics"},{key:"cat_mining_gear",value:"Mining Gear"},{key:"cat_home_garden",value:"Home & Garden"},{key:"cat_sports_bikes",value:"Sports & Bikes"},{key:"cat_tools",value:"Tools"},{key:"cat_games_hobbies",value:"Games & Hobbies"},{key:"cat_furniture",value:"Furniture"},{key:"cat_services",value:"Services"}].map(e=>(0,r.jsx)("button",{onClick:()=>Q(e.value),className:(0,i.cn)("rounded-xl px-3 py-1 text-sm",($||"")===e.value?"bg-orange-500 text-white":x?"bg-neutral-900 text-neutral-300":"bg-neutral-100 text-neutral-700"),children:(0,c.t)(e.key,B)},e.key))})]}),(0,r.jsxs)("div",{className:(0,i.cn)("rounded-2xl p-4",x?"border border-neutral-800 bg-neutral-950":"border border-neutral-300 bg-white"),children:[(0,r.jsx)("div",{className:(0,i.cn)("font-semibold mb-3",x?"text-neutral-200":"text-neutral-900"),children:(0,c.t)("type",B)}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{onClick:()=>X("all"),className:(0,i.cn)("rounded-xl px-3 py-1 text-sm","all"===W?"bg-orange-500 text-white":x?"bg-neutral-900 text-neutral-300":"bg-neutral-100 text-neutral-700"),children:(0,c.t)("all_listings",B)}),(0,r.jsx)("button",{onClick:()=>X("sell"),className:(0,i.cn)("rounded-xl px-3 py-1 text-sm","sell"===W?"bg-orange-500 text-white":x?"bg-neutral-900 text-neutral-300":"bg-neutral-100 text-neutral-700"),children:(0,c.t)("selling",B)}),(0,r.jsx)("button",{onClick:()=>X("want"),className:(0,i.cn)("rounded-xl px-3 py-1 text-sm","want"===W?"bg-orange-500 text-white":x?"bg-neutral-900 text-neutral-300":"bg-neutral-100 text-neutral-700"),children:(0,c.t)("looking_for",B)})]})]}),(0,r.jsxs)("div",{className:(0,i.cn)("rounded-2xl p-4",x?"border border-neutral-800 bg-neutral-950":"border border-neutral-300 bg-white"),children:[(0,r.jsx)("div",{className:(0,i.cn)("font-semibold mb-3",x?"text-neutral-200":"text-neutral-900"),children:"BTC"===m?(0,c.t)("price_btc",B):(0,c.t)("price_sats",B)}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("input",{value:G,onChange:e=>H(e.target.value),placeholder:"BTC"===m?"Min BTC":"Min sats",className:(0,i.cn)("w-1/2 rounded-xl px-3 py-2 text-sm",eN)}),(0,r.jsx)("span",{className:(0,i.cn)(x?"text-neutral-400":"text-neutral-500"),children:"—"}),(0,r.jsx)("input",{value:V,onChange:e=>z(e.target.value),placeholder:"BTC"===m?"Max BTC":"Max sats",className:(0,i.cn)("w-1/2 rounded-xl px-3 py-2 text-sm",eN)})]})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{onClick:ej,className:"flex-1 rounded-2xl px-4 py-3 text-sm bg-gradient-to-r from-orange-500 to-red-500 text-white",children:(0,c.t)("apply",B)}),(0,r.jsx)("button",{onClick:()=>{let e=new URLSearchParams;q&&e.set("q",q),t.push("/".concat(B,"/search?").concat(e.toString()))},className:(0,i.cn)("flex-1 rounded-2xl px-4 py-3 text-sm",x?"bg-neutral-900 text-neutral-300":"bg-neutral-100 text-neutral-700"),children:(0,c.t)("clear_all",B)})]})]}),(0,r.jsxs)("section",{className:"lg:col-span-9",children:["grid"===g?(0,r.jsxs)("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-3",children:[p.map(e=>(0,r.jsx)(s.dF,{listing:e,unit:m,btcCad:_,dark:x,onOpen:()=>E(e)},e.id)),ek&&(0,r.jsxs)("div",{className:(0,i.cn)("col-span-full rounded-3xl p-16 text-center border-2 border-dashed",x?"border-neutral-700 text-neutral-400":"border-neutral-300 text-neutral-500"),children:[(0,r.jsx)("div",{className:"text-4xl mb-4",children:"\uD83D\uDD0D"}),(0,r.jsx)("p",{className:(0,i.cn)("text-lg font-medium",x?"text-neutral-300":"text-neutral-700"),children:(0,c.t)("no_results",B)}),(0,r.jsx)("p",{className:(0,i.cn)("text-sm mt-2",x?"text-neutral-400":"text-neutral-600"),children:(0,c.t)("try_different",B)})]})]}):(0,r.jsxs)("div",{className:"space-y-4",children:[p.map(e=>(0,r.jsx)(s.tE,{listing:e,unit:m,btcCad:_,dark:x,onOpen:()=>E(e)},e.id)),ek&&(0,r.jsxs)("div",{className:(0,i.cn)("rounded-3xl p-16 text-center border-2 border-dashed",x?"border-neutral-700 text-neutral-400":"border-neutral-300 text-neutral-500"),children:[(0,r.jsx)("div",{className:"text-4xl mb-4",children:"\uD83D\uDD0D"}),(0,r.jsx)("p",{className:(0,i.cn)("text-lg font-medium",x?"text-neutral-300":"text-neutral-700"),children:(0,c.t)("no_results",B)}),(0,r.jsx)("p",{className:(0,i.cn)("text-sm mt-2",x?"text-neutral-400":"text-neutral-600"),children:(0,c.t)("try_different",B)})]})]}),y&&(0,r.jsx)("div",{ref:R,className:"py-8 text-center text-sm opacity-70",children:S?(0,c.t)("loading_more",B):""})]})]})]}),C&&(0,r.jsx)(s.dw,{listing:C,onClose:()=>E(null),unit:m,btcCad:_,dark:x,onChat:()=>{}}),em&&(0,r.jsx)(s.F8,{open:em,onClose:()=>eg(!1),initialCenter:{lat:Number(es||43.6532),lng:Number(ec||-79.3832),name:""},initialRadiusKm:eu,dark:x,onApply:(e,a)=>{ei(String(e.lat)),eo(String(e.lng)),ed(a);try{localStorage.setItem("userLocation",JSON.stringify(e)),localStorage.setItem("userRadiusKm",String(a))}catch(e){}let r=eb();r.set("lat",String(e.lat)),r.set("lng",String(e.lng)),r.set("radiusKm",String(a)),t.push("/".concat(B,"/search?").concat(r.toString())),eg(!1)}})]})}}}]);