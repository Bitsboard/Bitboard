var ae=Object.defineProperty;var ie=Object.getOwnPropertyDescriptor;var ue=Object.getOwnPropertyNames;var le=Object.prototype.hasOwnProperty;var de=(i,p)=>()=>(i&&(p=i(i=0)),p);var J=(i,p,C,x)=>{if(p&&typeof p=="object"||typeof p=="function")for(let k of ue(p))!le.call(i,k)&&k!==C&&ae(i,k,{get:()=>p[k],enumerable:!(x=ie(p,k))||x.enumerable});return i},Z=(i,p,C)=>(J(i,p,"default"),C&&J(C,p,"default"));var pe=i=>J(ae({},"__esModule",{value:!0}),i);var B={};import*as St from"async_hooks";var ne=de(()=>{Z(B,St)});import{__getNamedExports as he}from"../../../../__next-on-pages-dist__/webpack/1813.js";import{__getNamedExports as ge}from"../../../../__next-on-pages-dist__/webpack/d146f456c84ad77aa2bdb7f4ffff385c.js";import{__getNamedExports as me}from"../../../../__next-on-pages-dist__/webpack/0db62fc21f400f4ff93662ca787c3a50.js";import{__getNamedExports as ye}from"../../../../__next-on-pages-dist__/webpack/0406212c5b03d4d7d56d829c11dc80f8.js";import{__getNamedExports as xe}from"../../../../__next-on-pages-dist__/manifest/27d10e462fba646daaa29468a0656e12.js";var m=globalThis.__nextOnPagesRoutesIsolation.getProxyFor("/api/auth/callback"),ke=he(m,m,m),fe=ke.__chunk_1813,se=ge(m,m,m),Ne=se.__chunk_855,Ee=se.__chunk_3808,n=me(m,m,m),Te=n.__chunk_6195,Re=n.__chunk_2067,ve=n.__chunk_1548,De=n.__chunk_2780,be=n.__chunk_5612,Ae=n.__chunk_9614,Ie=n.__chunk_3628,we=n.__chunk_5403,Oe=n.__chunk_3,Pe=n.__chunk_9814,Se=n.__chunk_7114,$e=n.__chunk_7894,Le=n.__chunk_4414,Fe=n.__chunk_9307,Ce=n.__chunk_74,Ue=n.__chunk_7257,Ke=n.__chunk_7398,Me=n.__chunk_6839,Be=n.__chunk_5027,Ge=n.__chunk_2738,He=n.__chunk_2113,je=n.__chunk_2860,Xe=n.__chunk_7460,qe=n.__chunk_8427,We=n.__chunk_8997,Ye=n.__chunk_8024,Qe=n.__chunk_2403,Ve=n.__chunk_8690,ze=n.__chunk_6087,Je=n.__chunk_6265,Ze=n.__chunk_8610,et=n.__chunk_7959,tt=n.__chunk_4303,at=n.__chunk_3326,nt=n.__chunk_391,st=n.__chunk_8789,rt=n.__chunk_552,_t=n.__chunk_7649,ot=n.__chunk_2501,ct=n.__chunk_6443,it=n.__chunk_2034,ut=n.__chunk_3131,y=ye(m,m,m),lt=y.__chunk_5524,dt=y.__chunk_8536,pt=y.__chunk_6765,ht=y.__chunk_9859,gt=y.__chunk_4123,mt=y.__chunk_3412,yt=y.__chunk_8978,xt=y.__chunk_1812,kt=y.__chunk_1673,ft=y.__chunk_5376,Nt=y.__chunk_6617,Et=y.__chunk_5767,Tt=y.__chunk_3109,Rt=y.__chunk_641,vt=y.__chunk_5514,Dt=y.__chunk_5257,bt=y.__chunk_1616,At=y.__chunk_2328,ee=xe(m,m,m),It=ee.__NEXT_FONT_MANIFEST,wt=ee.__REACT_LOADABLE_MANIFEST,Ot=ee.__BUILD_MANIFEST,Kt=((i,p,C)=>(p._ENTRIES={},i.__BUILD_MANIFEST=Ot,i.__REACT_LOADABLE_MANIFEST=wt,i.__NEXT_FONT_MANIFEST=It,i.__INTERCEPTION_ROUTE_REWRITE_MANIFEST="[]",i.__PRERENDER_MANIFEST='{"version":4,"routes":{"/admin/users":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/admin/layout,_N_T_/admin/users/layout,_N_T_/admin/users/page,_N_T_/admin/users"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/admin/users","dataRoute":"/admin/users.rsc"},"/contact":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/contact/layout,_N_T_/contact/page,_N_T_/contact"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/contact","dataRoute":"/contact.rsc"},"/careers":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/careers/layout,_N_T_/careers/page,_N_T_/careers"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/careers","dataRoute":"/careers.rsc"},"/escrow":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/escrow/layout,_N_T_/escrow/page,_N_T_/escrow"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/escrow","dataRoute":"/escrow.rsc"},"/about":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/about/layout,_N_T_/about/page,_N_T_/about"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/about","dataRoute":"/about.rsc"},"/faq":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/faq/layout,_N_T_/faq/page,_N_T_/faq"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/faq","dataRoute":"/faq.rsc"},"/help":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/help/layout,_N_T_/help/page,_N_T_/help"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/help","dataRoute":"/help.rsc"},"/":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/page,_N_T_/"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/","dataRoute":"/index.rsc"},"/privacy":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/privacy/layout,_N_T_/privacy/page,_N_T_/privacy"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/privacy","dataRoute":"/privacy.rsc"},"/safety":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/safety/layout,_N_T_/safety/page,_N_T_/safety"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/safety","dataRoute":"/safety.rsc"},"/admin":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/admin/layout,_N_T_/admin/page,_N_T_/admin"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/admin","dataRoute":"/admin.rsc"},"/support":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/support/layout,_N_T_/support/page,_N_T_/support"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/support","dataRoute":"/support.rsc"},"/terms":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/terms/layout,_N_T_/terms/page,_N_T_/terms"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/terms","dataRoute":"/terms.rsc"},"/test-settings":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/test-settings/layout,_N_T_/test-settings/page,_N_T_/test-settings"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/test-settings","dataRoute":"/test-settings.rsc"},"/admin/listings":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/admin/layout,_N_T_/admin/listings/layout,_N_T_/admin/listings/page,_N_T_/admin/listings"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/admin/listings","dataRoute":"/admin/listings.rsc"},"/auth-success":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/auth-success/layout,_N_T_/auth-success/page,_N_T_/auth-success"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/auth-success","dataRoute":"/auth-success.rsc"},"/admin/chats":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/admin/layout,_N_T_/admin/chats/layout,_N_T_/admin/chats/page,_N_T_/admin/chats"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/admin/chats","dataRoute":"/admin/chats.rsc"},"/icon.svg":{"initialHeaders":{"cache-control":"public, immutable, no-transform, max-age=31536000","content-type":"image/svg+xml","x-next-cache-tags":"_N_T_/layout,_N_T_/icon.svg/layout,_N_T_/icon.svg/route,_N_T_/icon.svg"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/icon.svg","dataRoute":null},"/messages":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/messages/layout,_N_T_/messages/page,_N_T_/messages"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/messages","dataRoute":"/messages.rsc"}},"dynamicRoutes":{},"notFoundRoutes":[],"preview":{"previewModeId":"process.env.__NEXT_PREVIEW_MODE_ID","previewModeSigningKey":"process.env.__NEXT_PREVIEW_MODE_SIGNING_KEY","previewModeEncryptionKey":"process.env.__NEXT_PREVIEW_MODE_ENCRYPTION_KEY"}}',(()=>{"use strict";var x={},k={};function s(t){var o=k[t];if(o!==void 0)return o.exports;var a=k[t]={exports:{}},h=!0;try{x[t](a,a.exports,s),h=!1}finally{h&&delete k[t]}return a.exports}s.m=x,s.amdO={},(()=>{var t=[];s.O=(o,a,h,g)=>{if(a){g=g||0;for(var u=t.length;u>0&&t[u-1][2]>g;u--)t[u]=t[u-1];t[u]=[a,h,g];return}for(var l=1/0,u=0;u<t.length;u++){for(var[a,h,g]=t[u],N=!0,E=0;E<a.length;E++)l>=g&&Object.keys(s.O).every(L=>s.O[L](a[E]))?a.splice(E--,1):(N=!1,g<l&&(l=g));if(N){t.splice(u--,1);var I=h();I!==void 0&&(o=I)}}return o}})(),s.n=t=>{var o=t&&t.__esModule?()=>t.default:()=>t;return s.d(o,{a:o}),o},(()=>{var t,o=Object.getPrototypeOf?a=>Object.getPrototypeOf(a):a=>a.__proto__;s.t=function(a,h){if(1&h&&(a=this(a)),8&h||typeof a=="object"&&a&&(4&h&&a.__esModule||16&h&&typeof a.then=="function"))return a;var g=Object.create(null);s.r(g);var u={};t=t||[null,o({}),o([]),o(o)];for(var l=2&h&&a;typeof l=="object"&&!~t.indexOf(l);l=o(l))Object.getOwnPropertyNames(l).forEach(N=>u[N]=()=>a[N]);return u.default=()=>a,s.d(g,u),g}})(),s.d=(t,o)=>{for(var a in o)s.o(o,a)&&!s.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:o[a]})},s.e=()=>Promise.resolve(),s.g=function(){if(typeof p=="object")return p;try{return this||Function("return this")()}catch{if(typeof window=="object")return window}}(),s.o=(t,o)=>Object.prototype.hasOwnProperty.call(t,o),s.r=t=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t={5993:0};s.O.j=h=>t[h]===0;var o=(h,g)=>{var u,l,[N,E,I]=g,w=0;if(N.some(S=>t[S]!==0)){for(u in E)s.o(E,u)&&(s.m[u]=E[u]);if(I)var U=I(s)}for(h&&h(g);w<N.length;w++)l=N[w],s.o(t,l)&&t[l]&&t[l][0](),t[l]=0;return s.O(U)},a=i.webpackChunk_N_E=i.webpackChunk_N_E||[];a.forEach(o.bind(null,0)),a.push=o.bind(null,a.push.bind(a))})()})(),(i.webpackChunk_N_E=i.webpackChunk_N_E||[]).push([[9531],{3131:ut,2034:it,6443:ct,2501:ot,7649:_t,552:rt,8789:st,391:nt,3326:at,4303:tt,7959:et,8610:Ze,6265:Je,6087:ze,8690:Ve,2403:Qe,8024:Ye,8997:We,8427:qe,7460:Xe,2860:je,2113:He,2738:Ge,5027:Be,6839:Me,7398:Ke,7257:Ue,74:Ce,9307:Fe,4414:Le,7894:$e,7114:Se,9814:Pe,3:Oe,5403:we,3628:Ie,9614:Ae,5612:be,2780:De,1548:ve}]),(i.webpackChunk_N_E=i.webpackChunk_N_E||[]).push([[2703],{2328:At,1616:bt,5257:Dt,5514:vt,641:Rt,3109:Tt,5767:Et,6617:Nt,5376:ft,1673:kt,1812:xt,8978:yt,3412:mt,4123:gt,9859:ht,6765:pt,8536:dt,5524:lt}]),(i.webpackChunk_N_E=i.webpackChunk_N_E||[]).push([[292],{2067:Re,6195:Te,2750:(x,k,s)=>{"use strict";s.r(k),s.d(k,{ComponentMod:()=>W,default:()=>Y});var t={};s.r(t),s.d(t,{GET:()=>I,runtime:()=>E});var o={};s.r(o),s.d(o,{originalPathname:()=>L,patchFetch:()=>q,requestAsyncStorage:()=>U,routeModule:()=>w,serverHooks:()=>$,staticGenerationAsyncStorage:()=>S});var a=s(3109),h=s(5514),g=s(2860),u=s(2113),l=s(1813),N=s(3808);let E="edge";async function I(G){let K=new URL(G.url),H=K.searchParams.get("code"),[O,j]=(K.searchParams.get("state")||"").split("|"),A=decodeURIComponent(j||"/profile"),e=G.headers.get("cookie")||"",c=R=>RegExp(`(?:^|; )${R}=([^;]+)`).exec(e)?.[1],_=c("oauth_state"),r=c("oauth_verifier");if(!H||!O||!_||O!==_||!r)return new Response("Invalid state",{status:400});let D=process.env.GOOGLE_CLIENT_ID||"",f=process.env.GOOGLE_CLIENT_SECRET||"",b=await fetch("https://oauth2.googleapis.com/token",{method:"POST",headers:{"content-type":"application/x-www-form-urlencoded"},body:new URLSearchParams({client_id:D,client_secret:f,code:H,grant_type:"authorization_code",redirect_uri:new URL("/api/auth/callback",K.origin).toString(),code_verifier:r})});if(!b.ok){let R=await b.text();return new Response(`Token exchange failed: ${R}`,{status:400})}let P=await b.json(),T=await fetch("https://openidconnect.googleapis.com/v1/userinfo",{headers:{Authorization:`Bearer ${P.access_token}`}});if(!T.ok)return new Response("Failed to fetch user",{status:400});let d=await T.json();try{console.log("\u{1F510} OAuth callback: Starting user creation/update..."),console.log("\u{1F510} OAuth callback: User email:",d.email),console.log("\u{1F510} OAuth callback: User name:",d.name);let{env:R}=(0,N.getRequestContext)();console.log("\u{1F510} OAuth callback: Got request context, env keys:",Object.keys(R||{}));let v=R.DB;if(v){console.log("\u{1F510} OAuth callback: Database connection found, creating users table..."),await v.prepare(`CREATE TABLE IF NOT EXISTS users (
        id TEXT PRIMARY KEY,
        email TEXT UNIQUE,
        username TEXT UNIQUE,
        sso TEXT,
        verified INTEGER DEFAULT 0,
        created_at INTEGER NOT NULL,
        image TEXT,
        has_chosen_username INTEGER DEFAULT 0 CHECK (has_chosen_username IN (0, 1)),
        rating INTEGER DEFAULT 0,
        deals INTEGER DEFAULT 0,
        last_active INTEGER DEFAULT 0,
        is_admin INTEGER DEFAULT 0,
        banned INTEGER DEFAULT 0
      )`).run();try{let Q=await v.prepare("PRAGMA table_info(users)").all(),te=Q.results?.find(V=>V.name==="username");if(te&&te.notnull===1){console.log("\u{1F510} OAuth callback: Detected NOT NULL constraint on username, migrating table...");try{await v.prepare("DROP TABLE IF EXISTS users_new").run(),console.log("\u{1F510} OAuth callback: Cleaned up any existing migration tables")}catch(z){console.log("\u{1F510} OAuth callback: Cleanup check:",z)}await v.prepare(`CREATE TABLE users_new (
            id TEXT PRIMARY KEY,
            email TEXT UNIQUE,
            username TEXT UNIQUE,
            sso TEXT,
            verified INTEGER DEFAULT 0,
            created_at INTEGER NOT NULL,
            image TEXT,
            has_chosen_username INTEGER DEFAULT 0 CHECK (has_chosen_username IN (0, 1)),
            rating INTEGER DEFAULT 0,
            deals INTEGER DEFAULT 0,
            last_active INTEGER DEFAULT 0,
            is_admin INTEGER DEFAULT 0,
            banned INTEGER DEFAULT 0
          )`).run(),console.log("\u{1F510} OAuth callback: Created new users table with correct schema"),await v.prepare("INSERT INTO users_new (id, email, username, sso, verified, created_at, image, has_chosen_username, rating, deals, last_active, is_admin, banned) SELECT id, email, username, sso, verified, created_at, image, has_chosen_username, 0, 0, 0, 0, 0 FROM users").run(),console.log("\u{1F510} OAuth callback: Copied data to new table"),await v.prepare("DROP TABLE users").run(),await v.prepare("ALTER TABLE users_new RENAME TO users").run(),console.log("\u{1F510} OAuth callback: Successfully migrated users table to allow NULL usernames");let V=await v.prepare("PRAGMA table_info(users)").all(),ce=V.results?.find(z=>z.name==="username");console.log("\u{1F510} OAuth callback: Migration verification - username column notnull:",ce?.notnull)}else console.log("\u{1F510} OAuth callback: Username column already allows NULL, no migration needed")}catch(Q){console.log("\u{1F510} OAuth callback: Table migration check:",Q)}console.log("\u{1F510} OAuth callback: Users table ensured, checking for existing user...");let oe=await v.prepare("SELECT id, username FROM users WHERE email = ?").bind(d.email).all(),F=oe.results?.[0]?.id;F?(console.log("\u{1F510} OAuth callback: Updating existing user:",F),await v.prepare("UPDATE users SET image = COALESCE(?, image), sso = ? WHERE id = ?").bind(d.picture??null,"google",F).run(),console.log("\u{1F510} OAuth callback: Existing user updated successfully!")):(F=(0,l.k$)(),console.log("\u{1F510} OAuth callback: Creating new user with ID:",F),await v.prepare(`
          INSERT INTO users (id, email, username, sso, verified, created_at, image, has_chosen_username, rating, deals, last_active, is_admin, banned)
          VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
        `).bind(F,d.email,null,"google",1,Math.floor(Date.now()/1e3),d.picture??null,0,0,0,0,0,0).run(),console.log("\u{1F510} OAuth callback: New user created successfully!"))}else console.error("\u{1F510} OAuth callback: No database connection found!")}catch(R){console.error("\u{1F510} OAuth callback: Error during user creation/update:",R),console.error("\u{1F510} OAuth callback: Error details:",{message:R instanceof Error?R.message:"Unknown error",stack:R instanceof Error?R.stack:"No stack trace",userEmail:d.email,userData:d})}let X=(0,l.getAuthSecret)(),re=Math.floor(Date.now()/1e3)+604800,_e=await(0,l.yw)({sub:String(d.sub||d.email),name:d.name,email:d.email,picture:d.picture,sso:"google",exp:re},X),M=new Headers;return M.append("Set-Cookie",(0,l.pC)("session",_e,{httpOnly:!0,maxAgeSec:604800})),M.append("Set-Cookie",(0,l.kT)("oauth_state")),M.append("Set-Cookie",(0,l.kT)("oauth_verifier")),M.append("Location",A),new Response(null,{status:302,headers:M})}let w=new h.AppRouteRouteModule({definition:{kind:g.x.APP_ROUTE,page:"/api/auth/callback/route",pathname:"/api/auth/callback",filename:"route",bundlePath:"app/api/auth/callback/route"},resolvedPagePath:"/Users/georgedanayan/Bitboard/src/app/api/auth/callback/route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:U,staticGenerationAsyncStorage:S,serverHooks:$}=w,L="/api/auth/callback/route";function q(){return(0,u.XH)({serverHooks:$,staticGenerationAsyncStorage:S})}let W=o,Y=a.a.wrap(w)},3808:Ee,855:Ne,1813:fe},x=>{var k=t=>x(x.s=t);x.O(0,[9531,2703],()=>k(2750));var s=x.O();(p._ENTRIES=typeof p._ENTRIES>"u"?{}:p._ENTRIES)["middleware_app/api/auth/callback/route"]=s}]),function(){let x={exports:{},loaded:!1};return function(s,t){var o=Object.create,a=Object.defineProperty,h=Object.getOwnPropertyDescriptor,g=Object.getOwnPropertyNames,u=Object.getPrototypeOf,l=Object.prototype.hasOwnProperty,N=e=>a(e,"__esModule",{value:!0}),E=(e,c)=>{N(e);for(var _ in c)a(e,_,{get:c[_],enumerable:!0})},I=(e,c,_)=>{if(c&&typeof c=="object"||typeof c=="function")for(let r of g(c))!l.call(e,r)&&r!=="default"&&a(e,r,{get:()=>c[r],enumerable:!(_=h(c,r))||_.enumerable});return e},w=e=>I(N(a(e!=null?o(u(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);E(t,{default:()=>H});var U=w((ne(),pe(B))),S="@next/request-context",$=Symbol.for(S),L=Symbol.for("internal.storage");function q(){let e=p;if(!e[$]){let c=new U.AsyncLocalStorage,_={get:()=>c.getStore(),[L]:c};e[$]=_}return e[$]}var W=q();function Y(e,c){return W[L].run(e,c)}function G(e){let c={};return e&&e.forEach((_,r)=>{c[r]=_,r.toLowerCase()==="set-cookie"&&(c[r]=K(_))}),c}function K(e){let c=[],_=0,r,D,f,b,P;function T(){for(;_<e.length&&/\s/.test(e.charAt(_));)_+=1;return _<e.length}function d(){return D=e.charAt(_),D!=="="&&D!==";"&&D!==","}for(;_<e.length;){for(r=_,P=!1;T();)if(D=e.charAt(_),D===","){for(f=_,_+=1,T(),b=_;_<e.length&&d();)_+=1;_<e.length&&e.charAt(_)==="="?(P=!0,_=b,c.push(e.substring(r,f)),r=_):_=f+1}else _+=1;(!P||_>=e.length)&&c.push(e.substring(r,e.length))}return c}function H(e){let c=e.staticRoutes.map(r=>({regexp:new RegExp(r.namedRegex),page:r.page})),_=e.dynamicRoutes?.map(r=>({regexp:new RegExp(r.namedRegex),page:r.page}))||[];return async function(r,D){let f=new URL(r.url).pathname,b={};if(e.nextConfig?.basePath&&f.startsWith(e.nextConfig.basePath)&&(f=f.replace(e.nextConfig.basePath,"")||"/"),e.nextConfig?.i18n)for(let T of e.nextConfig.i18n.locales){let d=new RegExp(`^/${T}($|/)`,"i");if(f.match(d)){f=f.replace(d,"/")||"/";break}}for(let T of c)if(T.regexp.exec(f)){b.name=T.page;break}if(!b.name){let T=j(f);for(let d of _||[]){if(T&&!j(d.page))continue;let X=d.regexp.exec(f);if(X){b={name:d.page,params:X.groups};break}}}let P=await Y({waitUntil:D.waitUntil},()=>p._ENTRIES[`middleware_${e.name}`].default.call({},{request:{url:r.url,method:r.method,headers:G(r.headers),ip:O(r.headers,A.Ip),geo:{city:O(r.headers,A.City,!0),country:O(r.headers,A.Country,!0),latitude:O(r.headers,A.Latitude),longitude:O(r.headers,A.Longitude),region:O(r.headers,A.Region,!0)},nextConfig:e.nextConfig,page:b,body:r.body}}));return P.waitUntil&&D.waitUntil(P.waitUntil),P.response}}function O(e,c,_=!1){let r=e.get(c)||void 0;return _&&r?decodeURIComponent(r):r}function j(e){return e==="/api"||e.startsWith("/api/")}var A;(function(e){e.City="x-vercel-ip-city",e.Country="x-vercel-ip-country",e.Ip="x-real-ip",e.Latitude="x-vercel-ip-latitude",e.Longitude="x-vercel-ip-longitude",e.Region="x-vercel-ip-country-region"})(A||(A={}))}(x,x.exports),x.exports}.call({}).default({name:"app/api/auth/callback/route",staticRoutes:[{page:"/",regex:"^/(?:/)?$",routeKeys:{},namedRegex:"^/(?:/)?$"},{page:"/_not-found",regex:"^/_not\\-found(?:/)?$",routeKeys:{},namedRegex:"^/_not\\-found(?:/)?$"},{page:"/about",regex:"^/about(?:/)?$",routeKeys:{},namedRegex:"^/about(?:/)?$"},{page:"/admin",regex:"^/admin(?:/)?$",routeKeys:{},namedRegex:"^/admin(?:/)?$"},{page:"/admin/chats",regex:"^/admin/chats(?:/)?$",routeKeys:{},namedRegex:"^/admin/chats(?:/)?$"},{page:"/admin/listings",regex:"^/admin/listings(?:/)?$",routeKeys:{},namedRegex:"^/admin/listings(?:/)?$"},{page:"/admin/users",regex:"^/admin/users(?:/)?$",routeKeys:{},namedRegex:"^/admin/users(?:/)?$"},{page:"/auth-success",regex:"^/auth\\-success(?:/)?$",routeKeys:{},namedRegex:"^/auth\\-success(?:/)?$"},{page:"/careers",regex:"^/careers(?:/)?$",routeKeys:{},namedRegex:"^/careers(?:/)?$"},{page:"/contact",regex:"^/contact(?:/)?$",routeKeys:{},namedRegex:"^/contact(?:/)?$"},{page:"/escrow",regex:"^/escrow(?:/)?$",routeKeys:{},namedRegex:"^/escrow(?:/)?$"},{page:"/faq",regex:"^/faq(?:/)?$",routeKeys:{},namedRegex:"^/faq(?:/)?$"},{page:"/help",regex:"^/help(?:/)?$",routeKeys:{},namedRegex:"^/help(?:/)?$"},{page:"/icon.svg",regex:"^/icon\\.svg(?:/)?$",routeKeys:{},namedRegex:"^/icon\\.svg(?:/)?$"},{page:"/messages",regex:"^/messages(?:/)?$",routeKeys:{},namedRegex:"^/messages(?:/)?$"},{page:"/privacy",regex:"^/privacy(?:/)?$",routeKeys:{},namedRegex:"^/privacy(?:/)?$"},{page:"/safety",regex:"^/safety(?:/)?$",routeKeys:{},namedRegex:"^/safety(?:/)?$"},{page:"/search",regex:"^/search(?:/)?$",routeKeys:{},namedRegex:"^/search(?:/)?$"},{page:"/support",regex:"^/support(?:/)?$",routeKeys:{},namedRegex:"^/support(?:/)?$"},{page:"/terms",regex:"^/terms(?:/)?$",routeKeys:{},namedRegex:"^/terms(?:/)?$"},{page:"/test-settings",regex:"^/test\\-settings(?:/)?$",routeKeys:{},namedRegex:"^/test\\-settings(?:/)?$"}],dynamicRoutes:[{page:"/api/admin/chats/[chatId]/messages",regex:"^/api/admin/chats/([^/]+?)/messages(?:/)?$",routeKeys:{nxtPchatId:"nxtPchatId"},namedRegex:"^/api/admin/chats/(?<nxtPchatId>[^/]+?)/messages(?:/)?$"},{page:"/api/admin/listings/[listingId]/chats",regex:"^/api/admin/listings/([^/]+?)/chats(?:/)?$",routeKeys:{nxtPlistingId:"nxtPlistingId"},namedRegex:"^/api/admin/listings/(?<nxtPlistingId>[^/]+?)/chats(?:/)?$"},{page:"/api/admin/listings/[listingId]/images",regex:"^/api/admin/listings/([^/]+?)/images(?:/)?$",routeKeys:{nxtPlistingId:"nxtPlistingId"},namedRegex:"^/api/admin/listings/(?<nxtPlistingId>[^/]+?)/images(?:/)?$"},{page:"/api/admin/users/[userId]/chats",regex:"^/api/admin/users/([^/]+?)/chats(?:/)?$",routeKeys:{nxtPuserId:"nxtPuserId"},namedRegex:"^/api/admin/users/(?<nxtPuserId>[^/]+?)/chats(?:/)?$"},{page:"/api/admin/users/[userId]/listings",regex:"^/api/admin/users/([^/]+?)/listings(?:/)?$",routeKeys:{nxtPuserId:"nxtPuserId"},namedRegex:"^/api/admin/users/(?<nxtPuserId>[^/]+?)/listings(?:/)?$"},{page:"/api/chat/[chatId]",regex:"^/api/chat/([^/]+?)(?:/)?$",routeKeys:{nxtPchatId:"nxtPchatId"},namedRegex:"^/api/chat/(?<nxtPchatId>[^/]+?)(?:/)?$"},{page:"/api/listings/[id]",regex:"^/api/listings/([^/]+?)(?:/)?$",routeKeys:{nxtPid:"nxtPid"},namedRegex:"^/api/listings/(?<nxtPid>[^/]+?)(?:/)?$"},{page:"/api/listings/[id]/view",regex:"^/api/listings/([^/]+?)/view(?:/)?$",routeKeys:{nxtPid:"nxtPid"},namedRegex:"^/api/listings/(?<nxtPid>[^/]+?)/view(?:/)?$"},{page:"/api/users/[username]",regex:"^/api/users/([^/]+?)(?:/)?$",routeKeys:{nxtPusername:"nxtPusername"},namedRegex:"^/api/users/(?<nxtPusername>[^/]+?)(?:/)?$"},{page:"/api/users/[username]/listings",regex:"^/api/users/([^/]+?)/listings(?:/)?$",routeKeys:{nxtPusername:"nxtPusername"},namedRegex:"^/api/users/(?<nxtPusername>[^/]+?)/listings(?:/)?$"},{page:"/en/[username]",regex:"^/en/([^/]+?)(?:/)?$",routeKeys:{nxtPusername:"nxtPusername"},namedRegex:"^/en/(?<nxtPusername>[^/]+?)(?:/)?$"},{page:"/profile/[username]",regex:"^/profile/([^/]+?)(?:/)?$",routeKeys:{nxtPusername:"nxtPusername"},namedRegex:"^/profile/(?<nxtPusername>[^/]+?)(?:/)?$"}],nextConfig:{basePath:"",i18n:{locales:["en","fr","es","de"],defaultLocale:"en"}}})))(m,m,m);export{Kt as default};
