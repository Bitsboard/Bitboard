var Y=Object.defineProperty;var Q=Object.getOwnPropertyDescriptor;var ee=Object.getOwnPropertyNames;var te=Object.prototype.hasOwnProperty;var ae=(u,p)=>()=>(u&&(p=u(u=0)),p);var W=(u,p,K,R)=>{if(p&&typeof p=="object"||typeof p=="function")for(let E of ee(p))!te.call(u,E)&&E!==K&&Y(u,E,{get:()=>p[E],enumerable:!(R=Q(p,E))||R.enumerable});return u},V=(u,p,K)=>(W(u,p,"default"),K&&W(K,p,"default"));var ne=u=>W(Y({},"__esModule",{value:!0}),u);var H={};import*as It from"async_hooks";var Z=ae(()=>{V(H,It)});import{__getNamedExports as se}from"../../../../__next-on-pages-dist__/webpack/8084.js";import{__getNamedExports as re}from"../../../../__next-on-pages-dist__/webpack/65350c40fb927cd816847882c65007ef.js";import{__getNamedExports as oe}from"../../../../__next-on-pages-dist__/webpack/d146f456c84ad77aa2bdb7f4ffff385c.js";import{__getNamedExports as _e}from"../../../../__next-on-pages-dist__/webpack/0db62fc21f400f4ff93662ca787c3a50.js";import{__getNamedExports as ie}from"../../../../__next-on-pages-dist__/webpack/0406212c5b03d4d7d56d829c11dc80f8.js";import{__getNamedExports as ce}from"../../../../__next-on-pages-dist__/manifest/27d10e462fba646daaa29468a0656e12.js";var h=globalThis.__nextOnPagesRoutesIsolation.getProxyFor("/api/chat/send"),ue=se(h,h,h),le=ue.__chunk_8084,z=re(h,h,h),de=z.__chunk_5492,pe=z.__chunk_3059,J=oe(h,h,h),ge=J.__chunk_855,he=J.__chunk_3808,s=_e(h,h,h),xe=s.__chunk_6195,ye=s.__chunk_2067,me=s.__chunk_1548,fe=s.__chunk_2780,ke=s.__chunk_5612,Ne=s.__chunk_9614,Re=s.__chunk_3628,Ee=s.__chunk_5403,Te=s.__chunk_3,ve=s.__chunk_9814,Ie=s.__chunk_7114,be=s.__chunk_7894,Oe=s.__chunk_4414,Se=s.__chunk_9307,we=s.__chunk_74,Pe=s.__chunk_7257,Ae=s.__chunk_7398,$e=s.__chunk_6839,Ce=s.__chunk_5027,Fe=s.__chunk_2738,Me=s.__chunk_2113,Le=s.__chunk_2860,De=s.__chunk_7460,Ke=s.__chunk_8427,je=s.__chunk_8997,He=s.__chunk_8024,Ue=s.__chunk_2403,Be=s.__chunk_8690,qe=s.__chunk_6087,Ge=s.__chunk_6265,We=s.__chunk_8610,Ve=s.__chunk_7959,Xe=s.__chunk_4303,Ye=s.__chunk_3326,Ze=s.__chunk_391,ze=s.__chunk_8789,Je=s.__chunk_552,Qe=s.__chunk_7649,et=s.__chunk_2501,tt=s.__chunk_6443,at=s.__chunk_2034,nt=s.__chunk_3131,k=ie(h,h,h),st=k.__chunk_5524,rt=k.__chunk_8536,ot=k.__chunk_6765,_t=k.__chunk_9859,it=k.__chunk_4123,ct=k.__chunk_3412,ut=k.__chunk_8978,lt=k.__chunk_1812,dt=k.__chunk_1673,pt=k.__chunk_5376,gt=k.__chunk_6617,ht=k.__chunk_5767,xt=k.__chunk_3109,yt=k.__chunk_641,mt=k.__chunk_5514,ft=k.__chunk_5257,kt=k.__chunk_1616,Nt=k.__chunk_2328,X=ce(h,h,h),Rt=X.__NEXT_FONT_MANIFEST,Et=X.__REACT_LOADABLE_MANIFEST,Tt=X.__BUILD_MANIFEST,$t=((u,p,K)=>(p._ENTRIES={},u.__BUILD_MANIFEST=Tt,u.__REACT_LOADABLE_MANIFEST=Et,u.__NEXT_FONT_MANIFEST=Rt,u.__INTERCEPTION_ROUTE_REWRITE_MANIFEST="[]",u.__PRERENDER_MANIFEST='{"version":4,"routes":{"/admin/users":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/admin/layout,_N_T_/admin/users/layout,_N_T_/admin/users/page,_N_T_/admin/users"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/admin/users","dataRoute":"/admin/users.rsc"},"/contact":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/contact/layout,_N_T_/contact/page,_N_T_/contact"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/contact","dataRoute":"/contact.rsc"},"/careers":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/careers/layout,_N_T_/careers/page,_N_T_/careers"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/careers","dataRoute":"/careers.rsc"},"/escrow":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/escrow/layout,_N_T_/escrow/page,_N_T_/escrow"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/escrow","dataRoute":"/escrow.rsc"},"/about":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/about/layout,_N_T_/about/page,_N_T_/about"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/about","dataRoute":"/about.rsc"},"/faq":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/faq/layout,_N_T_/faq/page,_N_T_/faq"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/faq","dataRoute":"/faq.rsc"},"/help":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/help/layout,_N_T_/help/page,_N_T_/help"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/help","dataRoute":"/help.rsc"},"/":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/page,_N_T_/"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/","dataRoute":"/index.rsc"},"/privacy":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/privacy/layout,_N_T_/privacy/page,_N_T_/privacy"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/privacy","dataRoute":"/privacy.rsc"},"/safety":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/safety/layout,_N_T_/safety/page,_N_T_/safety"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/safety","dataRoute":"/safety.rsc"},"/admin":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/admin/layout,_N_T_/admin/page,_N_T_/admin"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/admin","dataRoute":"/admin.rsc"},"/support":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/support/layout,_N_T_/support/page,_N_T_/support"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/support","dataRoute":"/support.rsc"},"/terms":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/terms/layout,_N_T_/terms/page,_N_T_/terms"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/terms","dataRoute":"/terms.rsc"},"/test-settings":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/test-settings/layout,_N_T_/test-settings/page,_N_T_/test-settings"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/test-settings","dataRoute":"/test-settings.rsc"},"/admin/listings":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/admin/layout,_N_T_/admin/listings/layout,_N_T_/admin/listings/page,_N_T_/admin/listings"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/admin/listings","dataRoute":"/admin/listings.rsc"},"/auth-success":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/auth-success/layout,_N_T_/auth-success/page,_N_T_/auth-success"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/auth-success","dataRoute":"/auth-success.rsc"},"/admin/chats":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/admin/layout,_N_T_/admin/chats/layout,_N_T_/admin/chats/page,_N_T_/admin/chats"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/admin/chats","dataRoute":"/admin/chats.rsc"},"/icon.svg":{"initialHeaders":{"cache-control":"public, immutable, no-transform, max-age=31536000","content-type":"image/svg+xml","x-next-cache-tags":"_N_T_/layout,_N_T_/icon.svg/layout,_N_T_/icon.svg/route,_N_T_/icon.svg"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/icon.svg","dataRoute":null},"/messages":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/messages/layout,_N_T_/messages/page,_N_T_/messages"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/messages","dataRoute":"/messages.rsc"}},"dynamicRoutes":{},"notFoundRoutes":[],"preview":{"previewModeId":"process.env.__NEXT_PREVIEW_MODE_ID","previewModeSigningKey":"process.env.__NEXT_PREVIEW_MODE_SIGNING_KEY","previewModeEncryptionKey":"process.env.__NEXT_PREVIEW_MODE_ENCRYPTION_KEY"}}',(()=>{"use strict";var R={},E={};function r(a){var c=E[a];if(c!==void 0)return c.exports;var n=E[a]={exports:{}},g=!0;try{R[a](n,n.exports,r),g=!1}finally{g&&delete E[a]}return n.exports}r.m=R,r.amdO={},(()=>{var a=[];r.O=(c,n,g,m)=>{if(n){m=m||0;for(var d=a.length;d>0&&a[d-1][2]>m;d--)a[d]=a[d-1];a[d]=[n,g,m];return}for(var i=1/0,d=0;d<a.length;d++){for(var[n,g,m]=a[d],T=!0,I=0;I<n.length;I++)i>=m&&Object.keys(r.O).every(D=>r.O[D](n[I]))?n.splice(I--,1):(T=!1,m<i&&(i=m));if(T){a.splice(d--,1);var P=g();P!==void 0&&(c=P)}}return c}})(),r.n=a=>{var c=a&&a.__esModule?()=>a.default:()=>a;return r.d(c,{a:c}),c},(()=>{var a,c=Object.getPrototypeOf?n=>Object.getPrototypeOf(n):n=>n.__proto__;r.t=function(n,g){if(1&g&&(n=this(n)),8&g||typeof n=="object"&&n&&(4&g&&n.__esModule||16&g&&typeof n.then=="function"))return n;var m=Object.create(null);r.r(m);var d={};a=a||[null,c({}),c([]),c(c)];for(var i=2&g&&n;typeof i=="object"&&!~a.indexOf(i);i=c(i))Object.getOwnPropertyNames(i).forEach(T=>d[T]=()=>n[T]);return d.default=()=>n,r.d(m,d),m}})(),r.d=(a,c)=>{for(var n in c)r.o(c,n)&&!r.o(a,n)&&Object.defineProperty(a,n,{enumerable:!0,get:c[n]})},r.e=()=>Promise.resolve(),r.g=function(){if(typeof p=="object")return p;try{return this||Function("return this")()}catch{if(typeof window=="object")return window}}(),r.o=(a,c)=>Object.prototype.hasOwnProperty.call(a,c),r.r=a=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},(()=>{var a={5993:0};r.O.j=g=>a[g]===0;var c=(g,m)=>{var d,i,[T,I,P]=m,A=0;if(T.some(M=>a[M]!==0)){for(d in I)r.o(I,d)&&(r.m[d]=I[d]);if(P)var j=P(r)}for(g&&g(m);A<T.length;A++)i=T[A],r.o(a,i)&&a[i]&&a[i][0](),a[i]=0;return r.O(j)},n=u.webpackChunk_N_E=u.webpackChunk_N_E||[];n.forEach(c.bind(null,0)),n.push=c.bind(null,n.push.bind(n))})()})(),(u.webpackChunk_N_E=u.webpackChunk_N_E||[]).push([[9531],{3131:nt,2034:at,6443:tt,2501:et,7649:Qe,552:Je,8789:ze,391:Ze,3326:Ye,4303:Xe,7959:Ve,8610:We,6265:Ge,6087:qe,8690:Be,2403:Ue,8024:He,8997:je,8427:Ke,7460:De,2860:Le,2113:Me,2738:Fe,5027:Ce,6839:$e,7398:Ae,7257:Pe,74:we,9307:Se,4414:Oe,7894:be,7114:Ie,9814:ve,3:Te,5403:Ee,3628:Re,9614:Ne,5612:ke,2780:fe,1548:me}]),(u.webpackChunk_N_E=u.webpackChunk_N_E||[]).push([[2703],{2328:Nt,1616:kt,5257:ft,5514:mt,641:yt,3109:xt,5767:ht,6617:gt,5376:pt,1673:dt,1812:lt,8978:ut,3412:ct,4123:it,9859:_t,6765:ot,8536:rt,5524:st}]),(u.webpackChunk_N_E=u.webpackChunk_N_E||[]).push([[7333],{2067:ye,6195:xe,8124:(R,E,r)=>{"use strict";r.r(E),r.d(E,{ComponentMod:()=>B,default:()=>q});var a={};r.r(a),r.d(a,{POST:()=>P,runtime:()=>I});var c={};r.r(c),r.d(c,{originalPathname:()=>D,patchFetch:()=>U,requestAsyncStorage:()=>j,routeModule:()=>A,serverHooks:()=>L,staticGenerationAsyncStorage:()=>M});var n=r(3109),g=r(5514),m=r(2860),d=r(2113),i=r(5492),T=r(8084);let I="edge";async function P(G){try{let w,$;console.log("=== CHAT SEND API REACHED ===");let{chatId:C,text:F,listingId:x,otherUserId:e,userEmail:_}=await G.json();if(console.log("Request data:",{chatId:C,text:F,listingId:x,otherUserId:e,userEmail:_}),!_)return i.xk.json({error:"userEmail required"},{status:401});if(!F||!F.trim())return i.xk.json({error:"text required"},{status:400});if(!x||!e)return i.xk.json({error:"listingId and otherUserId required"},{status:400});let t=await(0,T.ZA)();if(!t)return i.xk.json({error:"no_db_binding"},{status:500});console.log("Validating listing exists...");let o=await t.prepare(`
      SELECT id, title FROM listings WHERE id = ?
    `).bind(x).all();if(!o.results||o.results.length===0)return console.log("\u274C Listing not found:",x),i.xk.json({error:"listing_not_found",message:`Listing with ID ${x} does not exist`},{status:404});console.log("\u2705 Listing found:",o.results[0].title),console.log("Validating other user exists...");let b=await t.prepare(`
      SELECT id, username FROM users WHERE username = ? OR id = ?
      LIMIT 1
    `).bind(e,e).all();if(!b.results||b.results.length===0){console.log("\u274C Other user not found:",e);let l=await t.prepare(`
        SELECT DISTINCT posted_by FROM listings WHERE posted_by = ?
        LIMIT 1
      `).bind(e).all();if(!l.results||l.results.length===0){console.log("\u274C User not found in listings either:",e);let y=await t.prepare(`
          SELECT DISTINCT posted_by FROM listings 
          WHERE posted_by IS NOT NULL AND posted_by != ''
          ORDER BY posted_by
          LIMIT 10
        `).all();return console.log("Available users in listings:",y.results?.map(O=>O.posted_by)||[]),i.xk.json({error:"user_not_found",message:`User ${e} does not exist or has no listings`,availableUsers:y.results?.map(O=>O.posted_by)||[]},{status:404})}}console.log("\u2705 Other user validated"),console.log("Getting actual user IDs for foreign key constraints...");let N=await t.prepare(`
      SELECT id FROM users WHERE email = ?
    `).bind(_).all();if(N.results&&N.results.length>0)w=N.results[0].id,console.log("\u2705 Current user ID found:",w);else{console.log("\u274C Current user not found in users table:",_);let l=process.env.GOOGLE_CLIENT_ID,y=process.env.GOOGLE_CLIENT_SECRET;return!l||!y?(console.error("\u274C OAuth environment variables missing on staging"),i.xk.json({error:"oauth_configuration_error",message:"OAuth is not properly configured on staging. User accounts cannot be created.",details:"Missing GOOGLE_CLIENT_ID or GOOGLE_CLIENT_SECRET environment variables"},{status:500})):i.xk.json({error:"user_not_found",message:`User ${_} not found in database. This suggests the OAuth flow failed during login.`,details:"User should have been created during OAuth authentication. Please try logging out and logging back in.",oauthConfigured:!!l&&!!y},{status:404})}let S=await t.prepare(`
      SELECT id FROM users WHERE username = ?
    `).bind(e).all();if(!S.results||!(S.results.length>0))return console.log("\u274C Other user not found in users table:",e),i.xk.json({error:"other_user_not_found",message:`User ${e} not found in database`},{status:404});$=S.results[0].id,console.log("\u2705 Other user ID found:",$);let f=C;if(!f){console.log("Finding or creating chat...");let l=await t.prepare(`
        SELECT id FROM chats 
        WHERE listing_id = ? AND 
        ((buyer_id = ? AND seller_id = ?) OR (buyer_id = ? AND seller_id = ?))
      `).bind(x,w,$,$,w).all();if(l.results&&l.results.length>0)f=l.results[0].id,console.log("Using existing chat:",f);else{f="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(y){let O=16*Math.random()|0;return(y==="x"?O:3&O|8).toString(16)}),console.log("Creating new chat with ID:",f);try{console.log("Debug: Checking data types..."),console.log("listingId type:",typeof x,"value:",x),console.log("userEmail type:",typeof _,"value:",_),console.log("otherUserId type:",typeof $,"value:",$);let y=await t.prepare(`
            SELECT id, typeof(id) as id_type FROM listings WHERE id = ? LIMIT 1
          `).bind(x).all();y.results&&y.results.length>0&&console.log("Listing ID type in database:",y.results[0].id_type);let O=await t.prepare(`
            INSERT INTO chats (id, listing_id, buyer_id, seller_id, created_at, last_message_at) 
            VALUES (?, ?, ?, ?, ?, ?)
          `).bind(f,parseInt(x)||x,w,$,Math.floor(Date.now()/1e3),Math.floor(Date.now()/1e3)).run();console.log("\u2705 New chat created successfully"),console.log("Chat insert result:",O)}catch(y){console.error("\u274C Error creating chat:",y);try{let O=await t.prepare(`
              PRAGMA foreign_key_list(chats)
            `).all();console.log("Foreign key constraints for chats table:",O.results)}catch(O){console.log("Could not get foreign key info:",O)}return i.xk.json({error:"chat_creation_failed",message:"Failed to create chat due to database constraint",details:String(y)},{status:500})}}}if(!f)return i.xk.json({error:"failed to create or find chat"},{status:500});let v="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(l){let y=16*Math.random()|0;return(l==="x"?y:3&y|8).toString(16)});console.log("Inserting message:",v);try{await t.prepare(`
        INSERT INTO messages (id, chat_id, from_id, text, created_at) 
        VALUES (?, ?, ?, ?, ?)
      `).bind(v,f,w,F.trim(),Math.floor(Date.now()/1e3)).run(),console.log("\u2705 Message inserted successfully")}catch(l){return console.error("\u274C Error inserting message:",l),i.xk.json({error:"message_insertion_failed",message:"Failed to insert message due to database constraint",details:String(l)},{status:500})}try{await t.prepare(`
        UPDATE chats 
        SET last_message_at = ? 
        WHERE id = ?
      `).bind(Math.floor(Date.now()/1e3),f).run(),console.log("\u2705 Chat timestamp updated successfully")}catch(l){console.error("\u274C Error updating chat timestamp:",l)}return console.log("\u{1F389} Message sent successfully!"),i.xk.json({ok:!0,messageId:v,chatId:f,timestamp:Date.now()})}catch(w){return console.error("=== CHAT SEND API ERROR ==="),console.error("Error in chat send API:",w),i.xk.json({error:"server_error"},{status:500})}}let A=new g.AppRouteRouteModule({definition:{kind:m.x.APP_ROUTE,page:"/api/chat/send/route",pathname:"/api/chat/send",filename:"route",bundlePath:"app/api/chat/send/route"},resolvedPagePath:"/Users/georgedanayan/Bitboard/src/app/api/chat/send/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:j,staticGenerationAsyncStorage:M,serverHooks:L}=A,D="/api/chat/send/route";function U(){return(0,d.XH)({serverHooks:L,staticGenerationAsyncStorage:M})}let B=c,q=n.a.wrap(A)},3808:he,855:ge,3059:pe,5492:de,8084:le},R=>{var E=a=>R(R.s=a);R.O(0,[9531,2703],()=>E(8124));var r=R.O();(p._ENTRIES=typeof p._ENTRIES>"u"?{}:p._ENTRIES)["middleware_app/api/chat/send/route"]=r}]),function(){let R={exports:{},loaded:!1};return function(r,a){var c=Object.create,n=Object.defineProperty,g=Object.getOwnPropertyDescriptor,m=Object.getOwnPropertyNames,d=Object.getPrototypeOf,i=Object.prototype.hasOwnProperty,T=e=>n(e,"__esModule",{value:!0}),I=(e,_)=>{T(e);for(var t in _)n(e,t,{get:_[t],enumerable:!0})},P=(e,_,t)=>{if(_&&typeof _=="object"||typeof _=="function")for(let o of m(_))!i.call(e,o)&&o!=="default"&&n(e,o,{get:()=>_[o],enumerable:!(t=g(_,o))||t.enumerable});return e},A=e=>P(T(n(e!=null?c(d(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);I(a,{default:()=>$});var j=A((Z(),ne(H))),M="@next/request-context",L=Symbol.for(M),D=Symbol.for("internal.storage");function U(){let e=p;if(!e[L]){let _=new j.AsyncLocalStorage,t={get:()=>_.getStore(),[D]:_};e[L]=t}return e[L]}var B=U();function q(e,_){return B[D].run(e,_)}function G(e){let _={};return e&&e.forEach((t,o)=>{_[o]=t,o.toLowerCase()==="set-cookie"&&(_[o]=w(t))}),_}function w(e){let _=[],t=0,o,b,N,S,f;function v(){for(;t<e.length&&/\s/.test(e.charAt(t));)t+=1;return t<e.length}function l(){return b=e.charAt(t),b!=="="&&b!==";"&&b!==","}for(;t<e.length;){for(o=t,f=!1;v();)if(b=e.charAt(t),b===","){for(N=t,t+=1,v(),S=t;t<e.length&&l();)t+=1;t<e.length&&e.charAt(t)==="="?(f=!0,t=S,_.push(e.substring(o,N)),o=t):t=N+1}else t+=1;(!f||t>=e.length)&&_.push(e.substring(o,e.length))}return _}function $(e){let _=e.staticRoutes.map(o=>({regexp:new RegExp(o.namedRegex),page:o.page})),t=e.dynamicRoutes?.map(o=>({regexp:new RegExp(o.namedRegex),page:o.page}))||[];return async function(o,b){let N=new URL(o.url).pathname,S={};if(e.nextConfig?.basePath&&N.startsWith(e.nextConfig.basePath)&&(N=N.replace(e.nextConfig.basePath,"")||"/"),e.nextConfig?.i18n)for(let v of e.nextConfig.i18n.locales){let l=new RegExp(`^/${v}($|/)`,"i");if(N.match(l)){N=N.replace(l,"/")||"/";break}}for(let v of _)if(v.regexp.exec(N)){S.name=v.page;break}if(!S.name){let v=F(N);for(let l of t||[]){if(v&&!F(l.page))continue;let y=l.regexp.exec(N);if(y){S={name:l.page,params:y.groups};break}}}let f=await q({waitUntil:b.waitUntil},()=>p._ENTRIES[`middleware_${e.name}`].default.call({},{request:{url:o.url,method:o.method,headers:G(o.headers),ip:C(o.headers,x.Ip),geo:{city:C(o.headers,x.City,!0),country:C(o.headers,x.Country,!0),latitude:C(o.headers,x.Latitude),longitude:C(o.headers,x.Longitude),region:C(o.headers,x.Region,!0)},nextConfig:e.nextConfig,page:S,body:o.body}}));return f.waitUntil&&b.waitUntil(f.waitUntil),f.response}}function C(e,_,t=!1){let o=e.get(_)||void 0;return t&&o?decodeURIComponent(o):o}function F(e){return e==="/api"||e.startsWith("/api/")}var x;(function(e){e.City="x-vercel-ip-city",e.Country="x-vercel-ip-country",e.Ip="x-real-ip",e.Latitude="x-vercel-ip-latitude",e.Longitude="x-vercel-ip-longitude",e.Region="x-vercel-ip-country-region"})(x||(x={}))}(R,R.exports),R.exports}.call({}).default({name:"app/api/chat/send/route",staticRoutes:[{page:"/",regex:"^/(?:/)?$",routeKeys:{},namedRegex:"^/(?:/)?$"},{page:"/_not-found",regex:"^/_not\\-found(?:/)?$",routeKeys:{},namedRegex:"^/_not\\-found(?:/)?$"},{page:"/about",regex:"^/about(?:/)?$",routeKeys:{},namedRegex:"^/about(?:/)?$"},{page:"/admin",regex:"^/admin(?:/)?$",routeKeys:{},namedRegex:"^/admin(?:/)?$"},{page:"/admin/chats",regex:"^/admin/chats(?:/)?$",routeKeys:{},namedRegex:"^/admin/chats(?:/)?$"},{page:"/admin/listings",regex:"^/admin/listings(?:/)?$",routeKeys:{},namedRegex:"^/admin/listings(?:/)?$"},{page:"/admin/users",regex:"^/admin/users(?:/)?$",routeKeys:{},namedRegex:"^/admin/users(?:/)?$"},{page:"/auth-success",regex:"^/auth\\-success(?:/)?$",routeKeys:{},namedRegex:"^/auth\\-success(?:/)?$"},{page:"/careers",regex:"^/careers(?:/)?$",routeKeys:{},namedRegex:"^/careers(?:/)?$"},{page:"/contact",regex:"^/contact(?:/)?$",routeKeys:{},namedRegex:"^/contact(?:/)?$"},{page:"/escrow",regex:"^/escrow(?:/)?$",routeKeys:{},namedRegex:"^/escrow(?:/)?$"},{page:"/faq",regex:"^/faq(?:/)?$",routeKeys:{},namedRegex:"^/faq(?:/)?$"},{page:"/help",regex:"^/help(?:/)?$",routeKeys:{},namedRegex:"^/help(?:/)?$"},{page:"/icon.svg",regex:"^/icon\\.svg(?:/)?$",routeKeys:{},namedRegex:"^/icon\\.svg(?:/)?$"},{page:"/messages",regex:"^/messages(?:/)?$",routeKeys:{},namedRegex:"^/messages(?:/)?$"},{page:"/privacy",regex:"^/privacy(?:/)?$",routeKeys:{},namedRegex:"^/privacy(?:/)?$"},{page:"/safety",regex:"^/safety(?:/)?$",routeKeys:{},namedRegex:"^/safety(?:/)?$"},{page:"/search",regex:"^/search(?:/)?$",routeKeys:{},namedRegex:"^/search(?:/)?$"},{page:"/support",regex:"^/support(?:/)?$",routeKeys:{},namedRegex:"^/support(?:/)?$"},{page:"/terms",regex:"^/terms(?:/)?$",routeKeys:{},namedRegex:"^/terms(?:/)?$"},{page:"/test-settings",regex:"^/test\\-settings(?:/)?$",routeKeys:{},namedRegex:"^/test\\-settings(?:/)?$"}],dynamicRoutes:[{page:"/api/admin/chats/[chatId]/messages",regex:"^/api/admin/chats/([^/]+?)/messages(?:/)?$",routeKeys:{nxtPchatId:"nxtPchatId"},namedRegex:"^/api/admin/chats/(?<nxtPchatId>[^/]+?)/messages(?:/)?$"},{page:"/api/admin/listings/[listingId]/chats",regex:"^/api/admin/listings/([^/]+?)/chats(?:/)?$",routeKeys:{nxtPlistingId:"nxtPlistingId"},namedRegex:"^/api/admin/listings/(?<nxtPlistingId>[^/]+?)/chats(?:/)?$"},{page:"/api/admin/listings/[listingId]/images",regex:"^/api/admin/listings/([^/]+?)/images(?:/)?$",routeKeys:{nxtPlistingId:"nxtPlistingId"},namedRegex:"^/api/admin/listings/(?<nxtPlistingId>[^/]+?)/images(?:/)?$"},{page:"/api/admin/users/[userId]/chats",regex:"^/api/admin/users/([^/]+?)/chats(?:/)?$",routeKeys:{nxtPuserId:"nxtPuserId"},namedRegex:"^/api/admin/users/(?<nxtPuserId>[^/]+?)/chats(?:/)?$"},{page:"/api/admin/users/[userId]/listings",regex:"^/api/admin/users/([^/]+?)/listings(?:/)?$",routeKeys:{nxtPuserId:"nxtPuserId"},namedRegex:"^/api/admin/users/(?<nxtPuserId>[^/]+?)/listings(?:/)?$"},{page:"/api/chat/[chatId]",regex:"^/api/chat/([^/]+?)(?:/)?$",routeKeys:{nxtPchatId:"nxtPchatId"},namedRegex:"^/api/chat/(?<nxtPchatId>[^/]+?)(?:/)?$"},{page:"/api/listings/[id]",regex:"^/api/listings/([^/]+?)(?:/)?$",routeKeys:{nxtPid:"nxtPid"},namedRegex:"^/api/listings/(?<nxtPid>[^/]+?)(?:/)?$"},{page:"/api/listings/[id]/view",regex:"^/api/listings/([^/]+?)/view(?:/)?$",routeKeys:{nxtPid:"nxtPid"},namedRegex:"^/api/listings/(?<nxtPid>[^/]+?)/view(?:/)?$"},{page:"/api/users/[username]",regex:"^/api/users/([^/]+?)(?:/)?$",routeKeys:{nxtPusername:"nxtPusername"},namedRegex:"^/api/users/(?<nxtPusername>[^/]+?)(?:/)?$"},{page:"/api/users/[username]/listings",regex:"^/api/users/([^/]+?)/listings(?:/)?$",routeKeys:{nxtPusername:"nxtPusername"},namedRegex:"^/api/users/(?<nxtPusername>[^/]+?)/listings(?:/)?$"},{page:"/en/[username]",regex:"^/en/([^/]+?)(?:/)?$",routeKeys:{nxtPusername:"nxtPusername"},namedRegex:"^/en/(?<nxtPusername>[^/]+?)(?:/)?$"},{page:"/profile/[username]",regex:"^/profile/([^/]+?)(?:/)?$",routeKeys:{nxtPusername:"nxtPusername"},namedRegex:"^/profile/(?<nxtPusername>[^/]+?)(?:/)?$"}],nextConfig:{basePath:"",i18n:{locales:["en","fr","es","de"],defaultLocale:"en"}}})))(h,h,h);export{$t as default};
