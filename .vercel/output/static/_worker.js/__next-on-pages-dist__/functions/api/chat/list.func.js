var Y=Object.defineProperty;var Z=Object.getOwnPropertyDescriptor;var z=Object.getOwnPropertyNames;var ee=Object.prototype.hasOwnProperty;var te=(c,d)=>()=>(c&&(d=c(c=0)),d);var U=(c,d,K,k)=>{if(d&&typeof d=="object"||typeof d=="function")for(let N of z(d))!ee.call(c,N)&&N!==K&&Y(c,N,{get:()=>d[N],enumerable:!(k=Z(d,N))||k.enumerable});return c},W=(c,d,K)=>(U(c,d,"default"),K&&U(K,d,"default"));var ae=c=>U(Y({},"__esModule",{value:!0}),c);var H={};import*as vt from"async_hooks";var J=te(()=>{W(H,vt)});import{__getNamedExports as ne}from"../../../../__next-on-pages-dist__/webpack/8084.js";import{__getNamedExports as se}from"../../../../__next-on-pages-dist__/webpack/65350c40fb927cd816847882c65007ef.js";import{__getNamedExports as _e}from"../../../../__next-on-pages-dist__/webpack/d146f456c84ad77aa2bdb7f4ffff385c.js";import{__getNamedExports as re}from"../../../../__next-on-pages-dist__/webpack/0db62fc21f400f4ff93662ca787c3a50.js";import{__getNamedExports as oe}from"../../../../__next-on-pages-dist__/webpack/0406212c5b03d4d7d56d829c11dc80f8.js";import{__getNamedExports as ie}from"../../../../__next-on-pages-dist__/manifest/27d10e462fba646daaa29468a0656e12.js";var g=globalThis.__nextOnPagesRoutesIsolation.getProxyFor("/api/chat/list"),ce=ne(g,g,g),ue=ce.__chunk_8084,V=se(g,g,g),le=V.__chunk_5492,de=V.__chunk_3059,Q=_e(g,g,g),pe=Q.__chunk_855,ge=Q.__chunk_3808,s=re(g,g,g),he=s.__chunk_6195,me=s.__chunk_2067,ye=s.__chunk_1548,xe=s.__chunk_2780,fe=s.__chunk_5612,ke=s.__chunk_9614,Ne=s.__chunk_3628,Re=s.__chunk_5403,Ee=s.__chunk_3,Te=s.__chunk_9814,ve=s.__chunk_7114,De=s.__chunk_7894,be=s.__chunk_4414,Ie=s.__chunk_9307,Pe=s.__chunk_74,Oe=s.__chunk_7257,Se=s.__chunk_7398,$e=s.__chunk_6839,Ae=s.__chunk_5027,we=s.__chunk_2738,Ce=s.__chunk_2113,Fe=s.__chunk_2860,Ke=s.__chunk_7460,Me=s.__chunk_8427,He=s.__chunk_8997,Le=s.__chunk_8024,Be=s.__chunk_2403,je=s.__chunk_8690,qe=s.__chunk_6087,Ue=s.__chunk_6265,We=s.__chunk_8610,Xe=s.__chunk_7959,Ge=s.__chunk_4303,Ye=s.__chunk_3326,Je=s.__chunk_391,Ve=s.__chunk_8789,Qe=s.__chunk_552,Ze=s.__chunk_7649,ze=s.__chunk_2501,et=s.__chunk_6443,tt=s.__chunk_2034,at=s.__chunk_3131,x=oe(g,g,g),nt=x.__chunk_5524,st=x.__chunk_8536,_t=x.__chunk_6765,rt=x.__chunk_9859,ot=x.__chunk_4123,it=x.__chunk_3412,ct=x.__chunk_8978,ut=x.__chunk_1812,lt=x.__chunk_1673,dt=x.__chunk_5376,pt=x.__chunk_6617,gt=x.__chunk_5767,ht=x.__chunk_3109,mt=x.__chunk_641,yt=x.__chunk_5514,xt=x.__chunk_5257,ft=x.__chunk_1616,kt=x.__chunk_2328,X=ie(g,g,g),Nt=X.__NEXT_FONT_MANIFEST,Rt=X.__REACT_LOADABLE_MANIFEST,Et=X.__BUILD_MANIFEST,$t=((c,d,K)=>(d._ENTRIES={},c.__BUILD_MANIFEST=Et,c.__REACT_LOADABLE_MANIFEST=Rt,c.__NEXT_FONT_MANIFEST=Nt,c.__INTERCEPTION_ROUTE_REWRITE_MANIFEST="[]",c.__PRERENDER_MANIFEST='{"version":4,"routes":{"/admin/users":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/admin/layout,_N_T_/admin/users/layout,_N_T_/admin/users/page,_N_T_/admin/users"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/admin/users","dataRoute":"/admin/users.rsc"},"/contact":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/contact/layout,_N_T_/contact/page,_N_T_/contact"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/contact","dataRoute":"/contact.rsc"},"/careers":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/careers/layout,_N_T_/careers/page,_N_T_/careers"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/careers","dataRoute":"/careers.rsc"},"/escrow":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/escrow/layout,_N_T_/escrow/page,_N_T_/escrow"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/escrow","dataRoute":"/escrow.rsc"},"/about":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/about/layout,_N_T_/about/page,_N_T_/about"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/about","dataRoute":"/about.rsc"},"/faq":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/faq/layout,_N_T_/faq/page,_N_T_/faq"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/faq","dataRoute":"/faq.rsc"},"/help":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/help/layout,_N_T_/help/page,_N_T_/help"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/help","dataRoute":"/help.rsc"},"/":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/page,_N_T_/"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/","dataRoute":"/index.rsc"},"/privacy":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/privacy/layout,_N_T_/privacy/page,_N_T_/privacy"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/privacy","dataRoute":"/privacy.rsc"},"/safety":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/safety/layout,_N_T_/safety/page,_N_T_/safety"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/safety","dataRoute":"/safety.rsc"},"/admin":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/admin/layout,_N_T_/admin/page,_N_T_/admin"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/admin","dataRoute":"/admin.rsc"},"/support":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/support/layout,_N_T_/support/page,_N_T_/support"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/support","dataRoute":"/support.rsc"},"/terms":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/terms/layout,_N_T_/terms/page,_N_T_/terms"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/terms","dataRoute":"/terms.rsc"},"/test-settings":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/test-settings/layout,_N_T_/test-settings/page,_N_T_/test-settings"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/test-settings","dataRoute":"/test-settings.rsc"},"/admin/listings":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/admin/layout,_N_T_/admin/listings/layout,_N_T_/admin/listings/page,_N_T_/admin/listings"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/admin/listings","dataRoute":"/admin/listings.rsc"},"/auth-success":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/auth-success/layout,_N_T_/auth-success/page,_N_T_/auth-success"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/auth-success","dataRoute":"/auth-success.rsc"},"/admin/chats":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/admin/layout,_N_T_/admin/chats/layout,_N_T_/admin/chats/page,_N_T_/admin/chats"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/admin/chats","dataRoute":"/admin/chats.rsc"},"/icon.svg":{"initialHeaders":{"cache-control":"public, immutable, no-transform, max-age=31536000","content-type":"image/svg+xml","x-next-cache-tags":"_N_T_/layout,_N_T_/icon.svg/layout,_N_T_/icon.svg/route,_N_T_/icon.svg"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/icon.svg","dataRoute":null},"/messages":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/messages/layout,_N_T_/messages/page,_N_T_/messages"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/messages","dataRoute":"/messages.rsc"}},"dynamicRoutes":{},"notFoundRoutes":[],"preview":{"previewModeId":"process.env.__NEXT_PREVIEW_MODE_ID","previewModeSigningKey":"process.env.__NEXT_PREVIEW_MODE_SIGNING_KEY","previewModeEncryptionKey":"process.env.__NEXT_PREVIEW_MODE_ENCRYPTION_KEY"}}',(()=>{"use strict";var k={},N={};function _(a){var o=N[a];if(o!==void 0)return o.exports;var n=N[a]={exports:{}},p=!0;try{k[a](n,n.exports,_),p=!1}finally{p&&delete N[a]}return n.exports}_.m=k,_.amdO={},(()=>{var a=[];_.O=(o,n,p,h)=>{if(n){h=h||0;for(var u=a.length;u>0&&a[u-1][2]>h;u--)a[u]=a[u-1];a[u]=[n,p,h];return}for(var l=1/0,u=0;u<a.length;u++){for(var[n,p,h]=a[u],E=!0,T=0;T<n.length;T++)l>=h&&Object.keys(_.O).every(C=>_.O[C](n[T]))?n.splice(T--,1):(E=!1,h<l&&(l=h));if(E){a.splice(u--,1);var I=p();I!==void 0&&(o=I)}}return o}})(),_.n=a=>{var o=a&&a.__esModule?()=>a.default:()=>a;return _.d(o,{a:o}),o},(()=>{var a,o=Object.getPrototypeOf?n=>Object.getPrototypeOf(n):n=>n.__proto__;_.t=function(n,p){if(1&p&&(n=this(n)),8&p||typeof n=="object"&&n&&(4&p&&n.__esModule||16&p&&typeof n.then=="function"))return n;var h=Object.create(null);_.r(h);var u={};a=a||[null,o({}),o([]),o(o)];for(var l=2&p&&n;typeof l=="object"&&!~a.indexOf(l);l=o(l))Object.getOwnPropertyNames(l).forEach(E=>u[E]=()=>n[E]);return u.default=()=>n,_.d(h,u),h}})(),_.d=(a,o)=>{for(var n in o)_.o(o,n)&&!_.o(a,n)&&Object.defineProperty(a,n,{enumerable:!0,get:o[n]})},_.e=()=>Promise.resolve(),_.g=function(){if(typeof d=="object")return d;try{return this||Function("return this")()}catch{if(typeof window=="object")return window}}(),_.o=(a,o)=>Object.prototype.hasOwnProperty.call(a,o),_.r=a=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},(()=>{var a={5993:0};_.O.j=p=>a[p]===0;var o=(p,h)=>{var u,l,[E,T,I]=h,P=0;if(E.some(A=>a[A]!==0)){for(u in T)_.o(T,u)&&(_.m[u]=T[u]);if(I)var M=I(_)}for(p&&p(h);P<E.length;P++)l=E[P],_.o(a,l)&&a[l]&&a[l][0](),a[l]=0;return _.O(M)},n=c.webpackChunk_N_E=c.webpackChunk_N_E||[];n.forEach(o.bind(null,0)),n.push=o.bind(null,n.push.bind(n))})()})(),(c.webpackChunk_N_E=c.webpackChunk_N_E||[]).push([[9531],{3131:at,2034:tt,6443:et,2501:ze,7649:Ze,552:Qe,8789:Ve,391:Je,3326:Ye,4303:Ge,7959:Xe,8610:We,6265:Ue,6087:qe,8690:je,2403:Be,8024:Le,8997:He,8427:Me,7460:Ke,2860:Fe,2113:Ce,2738:we,5027:Ae,6839:$e,7398:Se,7257:Oe,74:Pe,9307:Ie,4414:be,7894:De,7114:ve,9814:Te,3:Ee,5403:Re,3628:Ne,9614:ke,5612:fe,2780:xe,1548:ye}]),(c.webpackChunk_N_E=c.webpackChunk_N_E||[]).push([[2703],{2328:kt,1616:ft,5257:xt,5514:yt,641:mt,3109:ht,5767:gt,6617:pt,5376:dt,1673:lt,1812:ut,8978:ct,3412:it,4123:ot,9859:rt,6765:_t,8536:st,5524:nt}]),(c.webpackChunk_N_E=c.webpackChunk_N_E||[]).push([[4224],{2067:me,6195:he,3865:(k,N,_)=>{"use strict";_.r(N),_.d(N,{ComponentMod:()=>B,default:()=>j});var a={};_.r(a),_.d(a,{GET:()=>I,runtime:()=>T});var o={};_.r(o),_.d(o,{originalPathname:()=>C,patchFetch:()=>L,requestAsyncStorage:()=>M,routeModule:()=>P,serverHooks:()=>w,staticGenerationAsyncStorage:()=>A});var n=_(3109),p=_(5514),h=_(2860),u=_(2113),l=_(5492),E=_(8084);let T="edge";async function I(q){try{let v,S=new URL(q.url).searchParams.get("userEmail");if(!S)return l.xk.json({error:"userEmail required"},{status:401});let R=await(0,E.ZA)();if(!R)return l.xk.json({chats:[],error:"no_db_binding"},{status:500});let F=await R.prepare(`
      SELECT id FROM users WHERE email = ?
    `).bind(S).all();if(!F.results||F.results.length===0)return console.log("No user found for email:",S),l.xk.json({chats:[],userEmail:S,totalChats:0});let y=F.results[0].id;console.log("Found user ID:",y,"for email:",S);try{console.log("\u{1F527} Checking for old format chat IDs to migrate...");let t=await R.prepare(`
        SELECT id FROM chats WHERE id LIKE 'chat_%'
      `).all();if(t.results&&t.results.length>0){for(let r of(console.log("\u{1F527} Found",t.results.length,"chats with old format IDs, migrating..."),t.results)){let f=r.id,m="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(D){let b=16*Math.random()|0;return(D==="x"?b:3&b|8).toString(16)});console.log("\u{1F527} Migrating chat ID:",f,"\u2192",m),await R.prepare("UPDATE chats SET id = ? WHERE id = ?").bind(m,f).run(),await R.prepare("UPDATE messages SET chat_id = ? WHERE chat_id = ?").bind(m,f).run(),console.log("\u{1F527} Successfully migrated chat and messages")}console.log("\u{1F527} Chat ID migration completed")}else console.log("\u{1F527} No old format chat IDs found, migration not needed")}catch(t){console.log("\u{1F527} Chat ID migration failed:",t)}let e=`
      SELECT 
        c.id,
        c.listing_id,
        c.buyer_id,
        c.seller_id,
        c.created_at,
        c.last_message_at,
        l.title as listing_title,
        l.price_sat as listing_price,
        COALESCE(l.pricing_type, 'fixed') as listing_pricing_type,
        l.image_url as listing_image,
        l.category as listing_category,
        l.ad_type as listing_type,
        l.created_at as listing_created_at,
        l.location as listing_location,
        buyer.username as buyer_username,
        seller.username as seller_username,
        seller.verified as seller_verified,
        seller.rating as seller_rating,
        CASE 
          WHEN c.buyer_id = ? THEN 'buyer'
          ELSE 'seller'
        END as user_role,
        CASE 
          WHEN c.buyer_id = ? THEN seller.username
          ELSE buyer.username
        END as other_user_username
      FROM chats c
      JOIN listings l ON c.listing_id = l.id
      LEFT JOIN users buyer ON c.buyer_id = buyer.id
      LEFT JOIN users seller ON c.seller_id = seller.id
      WHERE c.buyer_id = ? OR c.seller_id = ?
      ORDER BY c.last_message_at DESC, c.created_at DESC
    `;console.log("\u{1F50D} Chat API: About to execute query with userId:",y),console.log("\u{1F50D} Chat API: Query:",e);try{v=await R.prepare(e).bind(y,y,y,y).all(),console.log("\u{1F50D} Chat API: Query executed successfully"),console.log("\u{1F50D} Chat API: Raw results:",v),console.log("\u{1F50D} Chat API: Found chats:",v.results?.length||0,"for user ID:",y)}catch(t){throw console.error("\u{1F50D} Chat API: Database query failed:",t),Error(`Database query failed: ${t.message}`)}let i=await Promise.all((v.results||[]).map(async t=>{let r=await R.prepare(`
        SELECT text, created_at, from_id 
        FROM messages 
        WHERE chat_id = ? 
        ORDER BY created_at DESC 
        LIMIT 1
      `).bind(t.id).all(),f=r.results?.[0],m=await R.prepare(`
        SELECT COUNT(*) as count 
        FROM messages 
        WHERE chat_id = ? AND from_id != ? AND (read_at IS NULL OR read_at = 0)
      `).bind(t.id,y).all(),D=m.results?.[0]?.count||0;return{...t,latest_message_text:f?.text||null,latest_message_time:f?.created_at||null,latest_message_from:f?.from_id||null,unread_count:D}}));return l.xk.json({chats:i,userEmail:S,userId:y,totalChats:i.length})}catch(v){return console.error("\u{1F50D} Chat API: Error fetching chats:",v),console.error("\u{1F50D} Chat API: Error details:",{message:v.message,stack:v.stack,name:v.name}),l.xk.json({error:"server_error",details:v.message,timestamp:new Date().toISOString()},{status:500})}}let P=new p.AppRouteRouteModule({definition:{kind:h.x.APP_ROUTE,page:"/api/chat/list/route",pathname:"/api/chat/list",filename:"route",bundlePath:"app/api/chat/list/route"},resolvedPagePath:"/Users/georgedanayan/Bitboard/src/app/api/chat/list/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:M,staticGenerationAsyncStorage:A,serverHooks:w}=P,C="/api/chat/list/route";function L(){return(0,u.XH)({serverHooks:w,staticGenerationAsyncStorage:A})}let B=o,j=n.a.wrap(P)},3808:ge,855:pe,3059:de,5492:le,8084:ue},k=>{var N=a=>k(k.s=a);k.O(0,[9531,2703],()=>N(3865));var _=k.O();(d._ENTRIES=typeof d._ENTRIES>"u"?{}:d._ENTRIES)["middleware_app/api/chat/list/route"]=_}]),function(){let k={exports:{},loaded:!1};return function(_,a){var o=Object.create,n=Object.defineProperty,p=Object.getOwnPropertyDescriptor,h=Object.getOwnPropertyNames,u=Object.getPrototypeOf,l=Object.prototype.hasOwnProperty,E=e=>n(e,"__esModule",{value:!0}),T=(e,i)=>{E(e);for(var t in i)n(e,t,{get:i[t],enumerable:!0})},I=(e,i,t)=>{if(i&&typeof i=="object"||typeof i=="function")for(let r of h(i))!l.call(e,r)&&r!=="default"&&n(e,r,{get:()=>i[r],enumerable:!(t=p(i,r))||t.enumerable});return e},P=e=>I(E(n(e!=null?o(u(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);T(a,{default:()=>S});var M=P((J(),ae(H))),A="@next/request-context",w=Symbol.for(A),C=Symbol.for("internal.storage");function L(){let e=d;if(!e[w]){let i=new M.AsyncLocalStorage,t={get:()=>i.getStore(),[C]:i};e[w]=t}return e[w]}var B=L();function j(e,i){return B[C].run(e,i)}function q(e){let i={};return e&&e.forEach((t,r)=>{i[r]=t,r.toLowerCase()==="set-cookie"&&(i[r]=v(t))}),i}function v(e){let i=[],t=0,r,f,m,D,b;function O(){for(;t<e.length&&/\s/.test(e.charAt(t));)t+=1;return t<e.length}function $(){return f=e.charAt(t),f!=="="&&f!==";"&&f!==","}for(;t<e.length;){for(r=t,b=!1;O();)if(f=e.charAt(t),f===","){for(m=t,t+=1,O(),D=t;t<e.length&&$();)t+=1;t<e.length&&e.charAt(t)==="="?(b=!0,t=D,i.push(e.substring(r,m)),r=t):t=m+1}else t+=1;(!b||t>=e.length)&&i.push(e.substring(r,e.length))}return i}function S(e){let i=e.staticRoutes.map(r=>({regexp:new RegExp(r.namedRegex),page:r.page})),t=e.dynamicRoutes?.map(r=>({regexp:new RegExp(r.namedRegex),page:r.page}))||[];return async function(r,f){let m=new URL(r.url).pathname,D={};if(e.nextConfig?.basePath&&m.startsWith(e.nextConfig.basePath)&&(m=m.replace(e.nextConfig.basePath,"")||"/"),e.nextConfig?.i18n)for(let O of e.nextConfig.i18n.locales){let $=new RegExp(`^/${O}($|/)`,"i");if(m.match($)){m=m.replace($,"/")||"/";break}}for(let O of i)if(O.regexp.exec(m)){D.name=O.page;break}if(!D.name){let O=F(m);for(let $ of t||[]){if(O&&!F($.page))continue;let G=$.regexp.exec(m);if(G){D={name:$.page,params:G.groups};break}}}let b=await j({waitUntil:f.waitUntil},()=>d._ENTRIES[`middleware_${e.name}`].default.call({},{request:{url:r.url,method:r.method,headers:q(r.headers),ip:R(r.headers,y.Ip),geo:{city:R(r.headers,y.City,!0),country:R(r.headers,y.Country,!0),latitude:R(r.headers,y.Latitude),longitude:R(r.headers,y.Longitude),region:R(r.headers,y.Region,!0)},nextConfig:e.nextConfig,page:D,body:r.body}}));return b.waitUntil&&f.waitUntil(b.waitUntil),b.response}}function R(e,i,t=!1){let r=e.get(i)||void 0;return t&&r?decodeURIComponent(r):r}function F(e){return e==="/api"||e.startsWith("/api/")}var y;(function(e){e.City="x-vercel-ip-city",e.Country="x-vercel-ip-country",e.Ip="x-real-ip",e.Latitude="x-vercel-ip-latitude",e.Longitude="x-vercel-ip-longitude",e.Region="x-vercel-ip-country-region"})(y||(y={}))}(k,k.exports),k.exports}.call({}).default({name:"app/api/chat/list/route",staticRoutes:[{page:"/",regex:"^/(?:/)?$",routeKeys:{},namedRegex:"^/(?:/)?$"},{page:"/_not-found",regex:"^/_not\\-found(?:/)?$",routeKeys:{},namedRegex:"^/_not\\-found(?:/)?$"},{page:"/about",regex:"^/about(?:/)?$",routeKeys:{},namedRegex:"^/about(?:/)?$"},{page:"/admin",regex:"^/admin(?:/)?$",routeKeys:{},namedRegex:"^/admin(?:/)?$"},{page:"/admin/chats",regex:"^/admin/chats(?:/)?$",routeKeys:{},namedRegex:"^/admin/chats(?:/)?$"},{page:"/admin/listings",regex:"^/admin/listings(?:/)?$",routeKeys:{},namedRegex:"^/admin/listings(?:/)?$"},{page:"/admin/users",regex:"^/admin/users(?:/)?$",routeKeys:{},namedRegex:"^/admin/users(?:/)?$"},{page:"/auth-success",regex:"^/auth\\-success(?:/)?$",routeKeys:{},namedRegex:"^/auth\\-success(?:/)?$"},{page:"/careers",regex:"^/careers(?:/)?$",routeKeys:{},namedRegex:"^/careers(?:/)?$"},{page:"/contact",regex:"^/contact(?:/)?$",routeKeys:{},namedRegex:"^/contact(?:/)?$"},{page:"/escrow",regex:"^/escrow(?:/)?$",routeKeys:{},namedRegex:"^/escrow(?:/)?$"},{page:"/faq",regex:"^/faq(?:/)?$",routeKeys:{},namedRegex:"^/faq(?:/)?$"},{page:"/help",regex:"^/help(?:/)?$",routeKeys:{},namedRegex:"^/help(?:/)?$"},{page:"/icon.svg",regex:"^/icon\\.svg(?:/)?$",routeKeys:{},namedRegex:"^/icon\\.svg(?:/)?$"},{page:"/messages",regex:"^/messages(?:/)?$",routeKeys:{},namedRegex:"^/messages(?:/)?$"},{page:"/privacy",regex:"^/privacy(?:/)?$",routeKeys:{},namedRegex:"^/privacy(?:/)?$"},{page:"/safety",regex:"^/safety(?:/)?$",routeKeys:{},namedRegex:"^/safety(?:/)?$"},{page:"/search",regex:"^/search(?:/)?$",routeKeys:{},namedRegex:"^/search(?:/)?$"},{page:"/support",regex:"^/support(?:/)?$",routeKeys:{},namedRegex:"^/support(?:/)?$"},{page:"/terms",regex:"^/terms(?:/)?$",routeKeys:{},namedRegex:"^/terms(?:/)?$"},{page:"/test-settings",regex:"^/test\\-settings(?:/)?$",routeKeys:{},namedRegex:"^/test\\-settings(?:/)?$"}],dynamicRoutes:[{page:"/api/admin/chats/[chatId]/messages",regex:"^/api/admin/chats/([^/]+?)/messages(?:/)?$",routeKeys:{nxtPchatId:"nxtPchatId"},namedRegex:"^/api/admin/chats/(?<nxtPchatId>[^/]+?)/messages(?:/)?$"},{page:"/api/admin/listings/[listingId]/chats",regex:"^/api/admin/listings/([^/]+?)/chats(?:/)?$",routeKeys:{nxtPlistingId:"nxtPlistingId"},namedRegex:"^/api/admin/listings/(?<nxtPlistingId>[^/]+?)/chats(?:/)?$"},{page:"/api/admin/listings/[listingId]/images",regex:"^/api/admin/listings/([^/]+?)/images(?:/)?$",routeKeys:{nxtPlistingId:"nxtPlistingId"},namedRegex:"^/api/admin/listings/(?<nxtPlistingId>[^/]+?)/images(?:/)?$"},{page:"/api/admin/users/[userId]/chats",regex:"^/api/admin/users/([^/]+?)/chats(?:/)?$",routeKeys:{nxtPuserId:"nxtPuserId"},namedRegex:"^/api/admin/users/(?<nxtPuserId>[^/]+?)/chats(?:/)?$"},{page:"/api/admin/users/[userId]/listings",regex:"^/api/admin/users/([^/]+?)/listings(?:/)?$",routeKeys:{nxtPuserId:"nxtPuserId"},namedRegex:"^/api/admin/users/(?<nxtPuserId>[^/]+?)/listings(?:/)?$"},{page:"/api/chat/[chatId]",regex:"^/api/chat/([^/]+?)(?:/)?$",routeKeys:{nxtPchatId:"nxtPchatId"},namedRegex:"^/api/chat/(?<nxtPchatId>[^/]+?)(?:/)?$"},{page:"/api/listings/[id]",regex:"^/api/listings/([^/]+?)(?:/)?$",routeKeys:{nxtPid:"nxtPid"},namedRegex:"^/api/listings/(?<nxtPid>[^/]+?)(?:/)?$"},{page:"/api/listings/[id]/view",regex:"^/api/listings/([^/]+?)/view(?:/)?$",routeKeys:{nxtPid:"nxtPid"},namedRegex:"^/api/listings/(?<nxtPid>[^/]+?)/view(?:/)?$"},{page:"/api/users/[username]",regex:"^/api/users/([^/]+?)(?:/)?$",routeKeys:{nxtPusername:"nxtPusername"},namedRegex:"^/api/users/(?<nxtPusername>[^/]+?)(?:/)?$"},{page:"/api/users/[username]/listings",regex:"^/api/users/([^/]+?)/listings(?:/)?$",routeKeys:{nxtPusername:"nxtPusername"},namedRegex:"^/api/users/(?<nxtPusername>[^/]+?)/listings(?:/)?$"},{page:"/en/[username]",regex:"^/en/([^/]+?)(?:/)?$",routeKeys:{nxtPusername:"nxtPusername"},namedRegex:"^/en/(?<nxtPusername>[^/]+?)(?:/)?$"},{page:"/profile/[username]",regex:"^/profile/([^/]+?)(?:/)?$",routeKeys:{nxtPusername:"nxtPusername"},namedRegex:"^/profile/(?<nxtPusername>[^/]+?)(?:/)?$"}],nextConfig:{basePath:"",i18n:{locales:["en","fr","es","de"],defaultLocale:"en"}}})))(g,g,g);export{$t as default};
