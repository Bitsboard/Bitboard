var i={},N=(l,c,m)=>(i.__chunk_8080=(A,n,r)=>{"use strict";r.d(n,{_:()=>T});var a=r(1813),s=r(3808);async function T(o){let u=o.headers.get("cookie")||"",E=/(?:^|; )session=([^;]+)/.exec(u)?.[1];if(!E)throw Error("unauthorized");let t=await(0,a.verifyJwtHS256)(E,(0,a.getAuthSecret)());if(!t?.email)throw Error("unauthorized");let{env:d}=(0,s.getRequestContext)(),e=d.DB;if(!e)throw Error("no_db");await e.prepare("CREATE TABLE IF NOT EXISTS users (id TEXT PRIMARY KEY, email TEXT UNIQUE, username TEXT UNIQUE, sso TEXT, verified INTEGER DEFAULT 0, is_admin INTEGER DEFAULT 0, banned INTEGER DEFAULT 0, created_at INTEGER NOT NULL, image TEXT)").run();try{await e.prepare("ALTER TABLE users ADD COLUMN is_admin INTEGER DEFAULT 0").run()}catch{}try{await e.prepare("ALTER TABLE users ADD COLUMN banned INTEGER DEFAULT 0").run()}catch{}if(new Set(["georged1997@gmail.com"]).has(String(t.email)))return e;if(!(await e.prepare("SELECT is_admin FROM users WHERE email = ?").bind(t.email).all()).results?.[0]?.is_admin)throw Error("forbidden");return e}},i);export{N as __getNamedExports};
